<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://p2yang.github.io/blog</id>
    <title>Joe's blog Blog</title>
    <updated>2022-12-11T17:36:43.000Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://p2yang.github.io/blog"/>
    <subtitle>Joe's blog Blog</subtitle>
    <icon>https://p2yang.github.io/img/favicon.ico</icon>
    <entry>
        <title type="html"><![CDATA[webpack@5 升级实践]]></title>
        <id>https://p2yang.github.io/blog/upgrade-webpack5</id>
        <link href="https://p2yang.github.io/blog/upgrade-webpack5"/>
        <updated>2022-12-11T17:36:43.000Z</updated>
        <summary type="html"><![CDATA[本文记录了 webpack@4 升级 webpack@5 步骤和注意事项。]]></summary>
        <content type="html"><![CDATA[<p>本文记录了 <code>webpack@4</code> 升级 <code>webpack@5</code> 步骤和注意事项。</p><blockquote><p><a href="https://webpack.js.org/migrate/5/" target="_blank" rel="noopener noreferrer">webpack 官方迁移指南</a></p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="升级-dependencies--devdependencies">升级 <code>dependencies</code> &amp; <code>devDependencies</code><a href="#升级-dependencies--devdependencies" class="hash-link" aria-label="升级-dependencies--devdependencies的直接链接" title="升级-dependencies--devdependencies的直接链接">​</a></h2><ol><li>webpack</li></ol><ul><li><code>"webpack": "^4.46.0"</code> -&gt; <code>^5.75.0</code></li><li><code>"webpack-dev-server": "^3.11.2"</code> -&gt; <code>^4.11.1</code></li><li><code>"webpack-merge": "^4.2.1"</code> -&gt; <code>^5.8.0</code></li><li><code>"webpack-bundle-analyzer": "^3.3.2"</code> -&gt; <code>^4.7.0</code></li></ul><ol start="2"><li>loaders</li></ol><ul><li>remove <code>url-loader</code>, <code>file-loader</code>, <code>raw-loader</code>, 使用 <code>webpack</code> 自带 Asset Modules 替代;</li><li>remove <code>cache-loader</code></li><li><code>"css-loader": "^5.2.7"</code> -&gt; <code>^6.7.2</code></li><li><code>"less-loader": "^7.3.0"</code> -&gt; <code>^11.1.0</code></li><li><code>"postcss-loader": "^4.3.0"</code> -&gt; <code>^7.0.2</code></li><li><code>"sass-loader": "^10.1.0"</code> -&gt; <code>^13.2.0</code></li><li><code>"style-loader": "^2.0.0"</code> -&gt; <code>^3.3.1</code></li><li><code>"vue-loader": "^15.9.6"</code> -&gt; <code>^15.9.8</code></li></ul><ol start="3"><li>plugins</li></ol><ul><li><code>"html-webpack-plugin": "^4.5.2"</code> -&gt; <code>^5.5.0</code></li><li><code>"mini-css-extract-plugin": "^1.6.0"</code> -&gt; <code>^2.7.2</code></li><li><code>"terser-webpack-plugin": "^2.2.1"</code> -&gt; <code>^5.3.6</code>, remove <code>terser</code></li><li>add <code>"css-minimizer-webpack-plugin": "^3.0.2"</code></li><li>remove <code>optimize-css-assets-webpack-plugin</code></li><li>remove <code>script-ext-html-webpack-plugin</code></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="更新-webpack-config">更新 webpack config<a href="#更新-webpack-config" class="hash-link" aria-label="更新 webpack config的直接链接" title="更新 webpack config的直接链接">​</a></h2><ol><li>依据<a href="https://webpack.js.org/migrate/5/#update-outdated-options" target="_blank" rel="noopener noreferrer">指南</a>，更新配置</li></ol><ul><li>add <code>optimization.moduleIds: 'deterministic'</code></li><li>add <code>cache.type: 'filesystem'</code></li><li>remove <code>new webpack.HashedModuleIdsPlugin()</code></li></ul><ol start="2"><li><p><code>webpack-merge</code>
修改 require 取值 <code>const merge = require('webpack-merge')</code> 为 <code>const { merge } = require('webpack-merge')</code></p></li><li><p>dev server</p></li></ol><ul><li><code>webpack-dev-server</code> API 有改动，需要修改传参顺序</li></ul><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token maybe-class-name">WebpackDevServer</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'webpack-dev-server'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// const server = new WebpackDevServer(compiler, devServerOptions)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// server.listen(PORT)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> server </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">WebpackDevServer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">devServerOptions</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> compiler</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">server</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">start</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">PORT</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>devServer options
删除 <code>contentBase</code>, <code>stats</code>，如下:</li></ul><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">static</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'public'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">host</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'0.0.0.0'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">client</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">overlay</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">open</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>devtool
<code>devtool: 'cheap-module-eval-source-map'</code> -&gt; <code>eval-cheap-source-map</code></li></ul><ol start="4"><li><p>删除自定义 open browser / ip 方法和调用</p></li><li><p><code>optimization</code></p></li></ol><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token literal-property property" style="color:#36acaa">optimization</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">runtimeChunk</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">removeAvailableModules</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">removeEmptyChunks</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">splitChunks</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="6"><li><p>删除 <code>script-ext-html-webpack-plugin</code>
由于 <code>script-ext-html-webpack-plugin</code> 不支持 <code>webpack@5</code>， 原本想用 <code>@vue/preload-webpack-plugin</code> 代替 <code>script-ext-html-webpack-plugin</code>, 结果发现 <code>@vue/preload-webpack-plugin</code> 配置复杂，无法仅 preload js 类型文件，所以暂时舍弃了。</p></li><li><p><code>vue-loader</code>
删除 <code>cacheDirectory</code>, <code>cacheIdentifier</code></p></li><li><p>图片、音频、字体等资源</p></li></ol><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">test</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token regex regex-delimiter" style="color:#36acaa">/</span><span class="token regex regex-source language-regex" style="color:#36acaa">\.(jpe?g|png|gif|svg)$</span><span class="token regex regex-delimiter" style="color:#36acaa">/</span><span class="token regex regex-flags" style="color:#36acaa">i</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">type</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'asset'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">parser</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">dataUrlCondition</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">maxSize</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1024</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">generator</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">filename</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> isProd </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'images/[hash:8][ext][query]'</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'images/[name].[hash:8][ext]'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">test</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token regex regex-delimiter" style="color:#36acaa">/</span><span class="token regex regex-source language-regex" style="color:#36acaa">\.(mp3|mp4|ogg|webm|ttf)$</span><span class="token regex regex-delimiter" style="color:#36acaa">/</span><span class="token regex regex-flags" style="color:#36acaa">i</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">type</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'asset/resource'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">generator</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">filename</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> isProd </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'assets/[hash:8][ext][query]'</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'assets/[name].[hash:8][ext]'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="9"><li><code>svg-sprite-loader</code>
原本项目中使用的是 <code>extract</code> 模式，打包成独立 svg 文件，通过接口请求后插入 DOM。现在由于 webpack@5 <code>cache.type: 'filesystem'</code>, 导致开发模式下非首次打包无法获取到 svg, 所以这里取消了 <code>extract</code> 模式。</li></ol><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">test</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token regex regex-delimiter" style="color:#36acaa">/</span><span class="token regex regex-source language-regex" style="color:#36acaa">\.svg$</span><span class="token regex regex-delimiter" style="color:#36acaa">/</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">loader</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'svg-sprite-loader'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">注意，需要删除 `new SpriteLoaderPlugin()`</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="10"><li><code>css-minimizer-webpack-plugin</code>
使用 <code>css-minimizer-webpack-plugin</code> 替代 <code>optimize-css-assets-webpack-plugin</code></li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="升级-nodejs--14150">升级 <code>nodejs &gt;= 14.15.0</code><a href="#升级-nodejs--14150" class="hash-link" aria-label="升级-nodejs--14150的直接链接" title="升级-nodejs--14150的直接链接">​</a></h2><ol><li>有部分 <code>dependencies</code> 最小 nodejs 版本为 <code>14.15.0</code>, 可酌情升级更高版本。</li><li>如果 <code>--max_old_space_size=4096</code> 分配内存超出了系统上限，可能导致打包卡住，可删除该配置。</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="适配业务代码">适配业务代码<a href="#适配业务代码" class="hash-link" aria-label="适配业务代码的直接链接" title="适配业务代码的直接链接">​</a></h2><ol><li><code>json</code> 文件 import 不能直接展开对象属性;</li><li>环境变量不能是 undefined，即使是空值，也需要主动声明;</li><li>根据提示增加 <code>resolve.fallback</code>，如 <code>querystring: require.resolve('querystring-es3')</code>;</li><li>自定义的预渲染插件无法直接修改 <code>compilation.assets</code>，这里把插件改写为 nodejs 脚本来执行预渲染逻辑。</li></ol><p>以上。</p>]]></content>
        <category label="webpack" term="webpack"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Mac 精品屏保推荐]]></title>
        <id>https://p2yang.github.io/blog/pictures</id>
        <link href="https://p2yang.github.io/blog/pictures"/>
        <updated>2020-06-12T17:55:26.000Z</updated>
        <summary type="html"><![CDATA[推荐 2 款精美的 Mac 屏幕保护程序。]]></summary>
        <content type="html"><![CDATA[<p>推荐 2 款精美的 Mac 屏幕保护程序。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="brooklyn">Brooklyn<a href="#brooklyn" class="hash-link" aria-label="Brooklyn的直接链接" title="Brooklyn的直接链接">​</a></h2><p>这是一款开源屏保，项目托管在 <a href="https://github.com/pedrommcarrasco/Brooklyn" target="_blank" rel="noopener noreferrer">Github 官方仓库</a> 上。效果如下：</p><p><img loading="lazy" alt="Brooklyn" src="/assets/images/showcase-98a728fe12d34ca0aaffb443450cc54c.gif" width="600" height="338" class="img_ev3q"></p><p>安装方式参考官方文档。如使用 <a href="https://brew.sh/" target="_blank" rel="noopener noreferrer"><code>Homebrew</code></a> 安装如下：</p><div class="language-zsh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-zsh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">brew cask install brooklyn</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="fliqlo">Fliqlo<a href="#fliqlo" class="hash-link" aria-label="Fliqlo的直接链接" title="Fliqlo的直接链接">​</a></h2><p>前往 <a href="https://fliqlo.com/#/screensaver" target="_blank" rel="noopener noreferrer">fliqlo.com</a> 下载 <code>dmg</code> 包安装即可。</p><p><img loading="lazy" alt="Fliqlo" src="/assets/images/fliqlo-15beffb0777606ca8bb0a61128312748.png" width="3360" height="2100" class="img_ev3q"></p><p><em>注：也支持 Windows.</em></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="设置">设置<a href="#设置" class="hash-link" aria-label="设置的直接链接" title="设置的直接链接">​</a></h2><p>打开 <code>系统偏好设置</code> -&gt; <code>桌面与屏幕保护程序</code> -&gt; 选择喜欢的屏保即可。</p>]]></content>
        <category label="tool" term="tool"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[HTML 应用 a 标签拨打电话字符问题]]></title>
        <id>https://p2yang.github.io/blog/web-tel</id>
        <link href="https://p2yang.github.io/blog/web-tel"/>
        <updated>2020-03-05T21:20:33.000Z</updated>
        <summary type="html"><![CDATA[在 HTML 中我们使用 a 标签来拨打电话。有一些特殊字符可能无法带入系统拨号键盘，如 #。]]></summary>
        <content type="html"><![CDATA[<p>在 HTML 中我们使用 <code>a</code> 标签来拨打电话。有一些特殊字符可能无法带入系统拨号键盘，如 <code>#</code>。</p><p>解决方法：对号码进行编码，如：</p><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">a</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">href</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">tel:123*312%23</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"> TEL: 123*312# </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">a</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>手机号中带有 <code>#</code>，编码后变成了 <code>%23</code>。
在 js 中，可以使用 <code>encodeURIComponent</code> 方法对其进行编码。</p><p>以上。</p>]]></content>
        <category label="web" term="web"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[【实用推荐】npm script 便捷执行工具 - ntl]]></title>
        <id>https://p2yang.github.io/blog/package-ntl</id>
        <link href="https://p2yang.github.io/blog/package-ntl"/>
        <updated>2020-02-28T12:05:24.000Z</updated>
        <summary type="html"><![CDATA[当 package.json 文件里写了很多 scripts 命令，一时想不起来有哪些怎么办？这里推荐一个 npm package: ntl, 不用打开配置文件, 直接在命令行中列出所有可执行命令，上下选择确认即可执行，非常方便。]]></summary>
        <content type="html"><![CDATA[<p>当 <code>package.json</code> 文件里写了很多 <code>scripts</code> 命令，一时想不起来有哪些怎么办？这里推荐一个 npm package: <code>ntl</code>, 不用打开配置文件, 直接在命令行中列出所有可执行命令，上下选择确认即可执行，非常方便。</p><p><img loading="lazy" src="https://ruyadorno.github.io/svg-demos/ntl/examples/option-rerun.svg" alt="ntl" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="安装">安装<a href="#安装" class="hash-link" aria-label="安装的直接链接" title="安装的直接链接">​</a></h2><div class="language-zsh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-zsh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">npm i ntl -g</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="配置">配置<a href="#配置" class="hash-link" aria-label="配置的直接链接" title="配置的直接链接">​</a></h2><p>打开 <code>~/.bash_profile</code> 新增配置环境变量：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># .bash_profile</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">NTL_RUNNER</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">yarn</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="使用">使用<a href="#使用" class="hash-link" aria-label="使用的直接链接" title="使用的直接链接">​</a></h2><p>在项目根目录下执行 <code>ntl</code> 命令即可。</p><div class="language-zsh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-zsh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ntl</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>其他参数，可查看<a href="https://www.npmjs.com/package/ntl" target="_blank" rel="noopener noreferrer">官方文档</a></p>]]></content>
        <category label="npm" term="npm"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[使用 fetch 方法下载后端文件]]></title>
        <id>https://p2yang.github.io/blog/fetch-download</id>
        <link href="https://p2yang.github.io/blog/fetch-download"/>
        <updated>2020-02-12T15:17:34.000Z</updated>
        <summary type="html"><![CDATA[在 web 页面中使用原生 window.fetch 下载后端文件。]]></summary>
        <content type="html"><![CDATA[<p>在 web 页面中使用原生 window.fetch 下载后端文件。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="过程分析">过程分析<a href="#过程分析" class="hash-link" aria-label="过程分析的直接链接" title="过程分析的直接链接">​</a></h2><ol><li>fetch url;</li><li>解析 <code>blob</code> 数据;</li><li>从 <code>response header</code> 中解析文件名;</li><li>动态创建 <code>a</code> 标签，利用 <code>download</code> 进行下载;</li><li>将 <code>blob</code> 数据转成 data uri, 赋值给 a href .</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="源码">源码<a href="#源码" class="hash-link" aria-label="源码的直接链接" title="源码的直接链接">​</a></h2><p><a href="https://gist.github.com/p2yang/72f23f5bd808d424f0b18af34f3c95e1" target="_blank" rel="noopener noreferrer">Gist Code</a></p><script src="https://gist.github.com/p2yang/72f23f5bd808d424f0b18af34f3c95e1.js"></script>]]></content>
        <category label="web" term="web"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Webpack DllPlugin 基本应用与实践]]></title>
        <id>https://p2yang.github.io/blog/webpack-dll</id>
        <link href="https://p2yang.github.io/blog/webpack-dll"/>
        <updated>2020-01-19T22:37:31.000Z</updated>
        <summary type="html"><![CDATA[Webpack 内置插件 DllPlugin 可以将一些较长时间内、稳定不变的包或组件拆分出来，以 script 外链的形式引入页面，以减少 webpack 打包时间，长期缓存。本文记录了 Webpack 内置插件 DllPlugin 基本应用方法。]]></summary>
        <content type="html"><![CDATA[<p><code>Webpack</code> 内置插件 <code>DllPlugin</code> 可以将一些较长时间内、稳定不变的包或组件拆分出来，以 <code>script</code> 外链的形式引入页面，以减少 <code>webpack</code> 打包时间，长期缓存。本文记录了 Webpack 内置插件 <code>DllPlugin</code> 基本应用方法。</p><p>本文环境以 <code>webpack@4.x</code> + <code>node@10.x</code> 为主，应用分 3 步：</p><ol><li>单独打包 <code>dll</code> 相关文件；</li><li>引入 <code>webpack</code> 配置；</li><li>插入外链；</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="单独打包-dll-相关文件">单独打包 <code>dll</code> 相关文件；<a href="#单独打包-dll-相关文件" class="hash-link" aria-label="单独打包-dll-相关文件的直接链接" title="单独打包-dll-相关文件的直接链接">​</a></h2><p>新建 <code>webpack</code> 配置文件 <code>webpack.dll.js</code>，添加 <code>dll</code> 相关文件打包配置，代码如下：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// webpack.dll.js</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> path </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'path'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> webpack </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'webpack'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">module</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">mode</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> process</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">env</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">NODE_ENV</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'production'</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'production'</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'development'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">entry</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">vendor</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">'vue'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">'vue-router'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">'vuex'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">output</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">path</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">resolve</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">__dirname</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'static/lib'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">filename</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'[name].dll.js'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">plugins</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">webpack</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">DllPlugin</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'[name]_[hash]'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">path</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">__dirname</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'.'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'[name]_manifest.json'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后在 <code>package.json</code> scripts 中添加命令:</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"scripts"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"build:dll"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"webpack --config dll/webpack.dll.js"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>配置好后，执行命令：</p><div class="language-zsh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-zsh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">npm run build:dll</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 或者</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yarn build:dll</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这里会将我们选取 vue 三件套打包出来(Github示例地址请看下文)，生成以下两个文件：</p><ul><li><code>vendor_manifest.json</code>: dll 配置文件，需要在 <code>webpack</code> 主配置文件中引入；</li><li><code>vendor.dll.js</code>: 目标依赖整合文件，最后需要外链。</li></ul><p>下面，来看下这两个文件的使用吧。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="使用-webpackdllreferenceplugin-引入-webpack-主配置">使用 <code>webpack.DllReferencePlugin</code> 引入 <code>webpack</code> 主配置；<a href="#使用-webpackdllreferenceplugin-引入-webpack-主配置" class="hash-link" aria-label="使用-webpackdllreferenceplugin-引入-webpack-主配置的直接链接" title="使用-webpackdllreferenceplugin-引入-webpack-主配置的直接链接">​</a></h2><p>在 <code>webpack</code> 主配置文件中引入 <code>vendor_manifest.json</code>：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// webpack.config.js</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> webpack </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'webpack'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">module</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// ...此处省略其他配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">plugins</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">webpack</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">DllReferencePlugin</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">context</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> __dirname</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">manifest</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'./vendor_manifest.json'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="插入外链">插入外链；<a href="#插入外链" class="hash-link" aria-label="插入外链；的直接链接" title="插入外链；的直接链接">​</a></h2><p>直接在 html 入口文件中引入。</p><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">script</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">src</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">/static/lib/vendor.dll.js</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token script"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">script</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>启动本地服务看看吧。</p><p>注：可使用 <a href="https://www.npmjs.com/package/anywhere" target="_blank" rel="noopener noreferrer"><code>anywhere</code></a> 或者 <a href="https://www.npmjs.com/package/http-server" target="_blank" rel="noopener noreferrer"><code>http-server</code></a> 快速启动本地静态服务器。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="github-示例">Github 示例<a href="#github-示例" class="hash-link" aria-label="Github 示例的直接链接" title="Github 示例的直接链接">​</a></h2><p><a href="https://github.com/p2yang/webpack-examples/tree/master/dll" target="_blank" rel="noopener noreferrer">Github 示例</a>
<a href="http://blog.p2yang.com" target="_blank" rel="noopener noreferrer">个人博客</a></p>]]></content>
        <category label="webpack" term="webpack"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Google Tag Manager 实用自定义 Variable 和 Trigger]]></title>
        <id>https://p2yang.github.io/blog/gtm-variables</id>
        <link href="https://p2yang.github.io/blog/gtm-variables"/>
        <updated>2020-01-16T22:19:47.000Z</updated>
        <summary type="html"><![CDATA[单独为每个埋点建立一个个 Tag 和 Trigger, 未免太过麻烦。这里记录几个实用的自定义变量，以提高效率。]]></summary>
        <content type="html"><![CDATA[<p>单独为每个埋点建立一个个 Tag 和 Trigger, 未免太过麻烦。这里记录几个实用的自定义变量，以提高效率。</p><p>Google Tag Manager 支持多种类型的自定义变量，前端同学可自行选择使用哪些。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="根据-css-selector-获取目标元素">根据 CSS Selector 获取目标元素<a href="#根据-css-selector-获取目标元素" class="hash-link" aria-label="根据 CSS Selector 获取目标元素的直接链接" title="根据 CSS Selector 获取目标元素的直接链接">​</a></h2><p>设置变量名为 <code>Find Closest</code>, 变量类型为 <code>Custom JavaScript</code>, 脚本内容如下：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">target</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> selector</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">target</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">matches</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">selector</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!</span><span class="token plain">target</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">matches</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'body'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      target </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> target</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">parentElement</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> target</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">matches</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">selector</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> target </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword nil" style="color:#00009f">undefined</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="GTM Variable" src="/assets/images/gtm2-variable-d2324d090702f402804df2fedb487ecd.png" width="2170" height="1152" class="img_ev3q"></p><p>下面会有具体应用。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="自定义-ga-event-category--event-label-变量">自定义 GA Event Category / Event Label 变量<a href="#自定义-ga-event-category--event-label-变量" class="hash-link" aria-label="自定义 GA Event Category / Event Label 变量的直接链接" title="自定义 GA Event Category / Event Label 变量的直接链接">​</a></h2><p>在关联配置 GA 的 Event track 类型中，可以使用变量，而不用把值写死。同样是先命名变量，设置变量类型为 <code>Custom JavaScript</code>。
脚本内容示例如下：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> el </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token maybe-class-name">Find</span><span class="token plain"> </span><span class="token maybe-class-name">Closest</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token maybe-class-name">Click</span><span class="token plain"> </span><span class="token maybe-class-name">Element</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'[data-label]'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> el </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> el</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">dataset</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">label</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">''</span><span class="token plain">；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>脚本中出现的 <code>\{\{Find Closest\}\}</code> 就是上面自定义的变量 <code>Find Closest</code>，双大括号是调用取值语法。
不同的是，<code>\{\{Click Element\}\}</code> 是 Google Tag Manager 内置变量，表示被点击的 DOM 元素。
<code>selector</code> 可自行改写。</p><p>该变量的作用是获取到被点击目标元素上的 <code>data-label</code> 值，没有则返回空字符串。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="自定义-data-layer-变量">自定义 Data Layer 变量<a href="#自定义-data-layer-变量" class="hash-link" aria-label="自定义 Data Layer 变量的直接链接" title="自定义 Data Layer 变量的直接链接">​</a></h2><p>如果需要手动上报的话，这里可以新建一个 <code>Data Layer Variable</code> 类型的变量，所定义的值可以被 <code>window.dataLayer</code> 上报。示例如下：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// 注意：此处代码需要在自己的页面中添加</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token dom variable" style="color:#36acaa">window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">dataLayer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">'event'</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'track_custom_event'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">'xxx'</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'待上报的值'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>其中 <code>xxx</code> 即为此处需要定义的 Data Layer Variable Name。</p><p>再建立一个自定义事件变量，变量类型选 <code>Custom Event</code>。</p><p>然后，可以建一个 <code>Custom Event</code> 类型的 Trigger 来响应手动上报事件。
其中 Event Name 可使用正则表达式，如：<code>[A-Z0-9_]+</code>。
注意，需要加一条匹配规则，用来排除官方的事件类型 - <code>gtm</code>，示图如下：</p><p><img loading="lazy" alt="GTM Trigger" src="/assets/images/gtm2-trigger-3ca20f70555e151a79d2db5d759223a6.png" width="2170" height="1200" class="img_ev3q"></p>]]></content>
        <category label="Google Tag Manager" term="Google Tag Manager"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Google Tag Manager 基本应用与实践]]></title>
        <id>https://p2yang.github.io/blog/gtm-basic</id>
        <link href="https://p2yang.github.io/blog/gtm-basic"/>
        <updated>2020-01-15T16:05:36.000Z</updated>
        <summary type="html"><![CDATA[如果想了解网站用户的互动情况，我们该怎么统计？]]></summary>
        <content type="html"><![CDATA[<p>如果想了解网站用户的互动情况，我们该怎么统计？</p><p>国际站的话可以选用 Google 家的 <code>gtag.js</code>, <code>analytics.js</code>，或者 <code>gtm.js</code> 进行开发。前两个的功能和使用方式基本一致，具体差别可参考下方的开发文档。<code>gtm.js</code> 就是本文要说的 Google Tag Manager 的 js 库。</p><p>Google Tag Manager (下文简称 "GTM") 功能齐全，支持 Google 代码和第三方代码。相比于 <code>gtag.js</code> 和 <code>analytics.js</code> 代码侵入性更小，也是 Google 推荐使用的工具。</p><p>话不多说，开始正文。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-注册-container">1. 注册 Container<a href="#1-注册-container" class="hash-link" aria-label="1. 注册 Container的直接链接" title="1. 注册 Container的直接链接">​</a></h2><p>填好容器名，选择应用平台。容器名建议以应用平台来命名，这里我使用的是域名 <code>blog.p2yang.com</code>。</p><p><img loading="lazy" alt="GTM Container" src="/assets/images/gtm-container-1cdb1e6998303159fc0e93c449a151f2.png" width="1480" height="1308" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-安装">2. 安装<a href="#2-安装" class="hash-link" aria-label="2. 安装的直接链接" title="2. 安装的直接链接">​</a></h2><p>注册完成后，会自动分配一个 <code>id</code>, 并且弹窗提示安装方法，将代码片段插入自己的页面即可。
页面加载时，会异步请求 <code>gtm.js</code> 库和相关配置，并且提供了浏览器禁止 js 脚本的弥补方法。</p><p>这里摘录下代码段：</p><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- Google Tag Manager --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">script</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript keyword" style="color:#00009f">function</span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript parameter">w</span><span class="token script language-javascript parameter punctuation" style="color:#393A34">,</span><span class="token script language-javascript parameter">d</span><span class="token script language-javascript parameter punctuation" style="color:#393A34">,</span><span class="token script language-javascript parameter">s</span><span class="token script language-javascript parameter punctuation" style="color:#393A34">,</span><span class="token script language-javascript parameter">l</span><span class="token script language-javascript parameter punctuation" style="color:#393A34">,</span><span class="token script language-javascript parameter">i</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript punctuation" style="color:#393A34">{</span><span class="token script language-javascript">w</span><span class="token script language-javascript punctuation" style="color:#393A34">[</span><span class="token script language-javascript">l</span><span class="token script language-javascript punctuation" style="color:#393A34">]</span><span class="token script language-javascript operator" style="color:#393A34">=</span><span class="token script language-javascript">w</span><span class="token script language-javascript punctuation" style="color:#393A34">[</span><span class="token script language-javascript">l</span><span class="token script language-javascript punctuation" style="color:#393A34">]</span><span class="token script language-javascript operator" style="color:#393A34">||</span><span class="token script language-javascript punctuation" style="color:#393A34">[</span><span class="token script language-javascript punctuation" style="color:#393A34">]</span><span class="token script language-javascript punctuation" style="color:#393A34">;</span><span class="token script language-javascript">w</span><span class="token script language-javascript punctuation" style="color:#393A34">[</span><span class="token script language-javascript">l</span><span class="token script language-javascript punctuation" style="color:#393A34">]</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript method function property-access" style="color:#d73a49">push</span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript punctuation" style="color:#393A34">{</span><span class="token script language-javascript string-property property" style="color:#36acaa">'gtm.start'</span><span class="token script language-javascript operator" style="color:#393A34">:</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript"></span><span class="token script language-javascript keyword" style="color:#00009f">new</span><span class="token script language-javascript"> </span><span class="token script language-javascript class-name">Date</span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript method function property-access" style="color:#d73a49">getTime</span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript punctuation" style="color:#393A34">,</span><span class="token script language-javascript literal-property property" style="color:#36acaa">event</span><span class="token script language-javascript operator" style="color:#393A34">:</span><span class="token script language-javascript string" style="color:#e3116c">'gtm.js'</span><span class="token script language-javascript punctuation" style="color:#393A34">}</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript punctuation" style="color:#393A34">;</span><span class="token script language-javascript keyword" style="color:#00009f">var</span><span class="token script language-javascript"> f</span><span class="token script language-javascript operator" style="color:#393A34">=</span><span class="token script language-javascript">d</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript method function property-access" style="color:#d73a49">getElementsByTagName</span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript">s</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript punctuation" style="color:#393A34">[</span><span class="token script language-javascript number" style="color:#36acaa">0</span><span class="token script language-javascript punctuation" style="color:#393A34">]</span><span class="token script language-javascript punctuation" style="color:#393A34">,</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">j</span><span class="token script language-javascript operator" style="color:#393A34">=</span><span class="token script language-javascript">d</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript method function property-access" style="color:#d73a49">createElement</span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript">s</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript punctuation" style="color:#393A34">,</span><span class="token script language-javascript">dl</span><span class="token script language-javascript operator" style="color:#393A34">=</span><span class="token script language-javascript">l</span><span class="token script language-javascript operator" style="color:#393A34">!=</span><span class="token script language-javascript string" style="color:#e3116c">'dataLayer'</span><span class="token script language-javascript operator" style="color:#393A34">?</span><span class="token script language-javascript string" style="color:#e3116c">'&amp;l='</span><span class="token script language-javascript operator" style="color:#393A34">+</span><span class="token script language-javascript">l</span><span class="token script language-javascript operator" style="color:#393A34">:</span><span class="token script language-javascript string" style="color:#e3116c">''</span><span class="token script language-javascript punctuation" style="color:#393A34">;</span><span class="token script language-javascript">j</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">async</span><span class="token script language-javascript operator" style="color:#393A34">=</span><span class="token script language-javascript boolean" style="color:#36acaa">true</span><span class="token script language-javascript punctuation" style="color:#393A34">;</span><span class="token script language-javascript">j</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">src</span><span class="token script language-javascript operator" style="color:#393A34">=</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript"></span><span class="token script language-javascript string" style="color:#e3116c">'https://www.googletagmanager.com/gtm.js?id='</span><span class="token script language-javascript operator" style="color:#393A34">+</span><span class="token script language-javascript">i</span><span class="token script language-javascript operator" style="color:#393A34">+</span><span class="token script language-javascript">dl</span><span class="token script language-javascript punctuation" style="color:#393A34">;</span><span class="token script language-javascript">f</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">parentNode</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript method function property-access" style="color:#d73a49">insertBefore</span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript">j</span><span class="token script language-javascript punctuation" style="color:#393A34">,</span><span class="token script language-javascript">f</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript punctuation" style="color:#393A34">;</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript"></span><span class="token script language-javascript punctuation" style="color:#393A34">}</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript dom variable" style="color:#36acaa">window</span><span class="token script language-javascript punctuation" style="color:#393A34">,</span><span class="token script language-javascript dom variable" style="color:#36acaa">document</span><span class="token script language-javascript punctuation" style="color:#393A34">,</span><span class="token script language-javascript string" style="color:#e3116c">'script'</span><span class="token script language-javascript punctuation" style="color:#393A34">,</span><span class="token script language-javascript string" style="color:#e3116c">'dataLayer'</span><span class="token script language-javascript punctuation" style="color:#393A34">,</span><span class="token script language-javascript string" style="color:#e3116c">'GTM-NLZZ7XB'</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript punctuation" style="color:#393A34">;</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">script</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- End Google Tag Manager --&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- Google Tag Manager (noscript) --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">noscript</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">iframe</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">src</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">https://www.googletagmanager.com/ns.html?id=GTM-TFMV3HS</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f"></span><span class="token tag attr-name" style="color:#00a4db">height</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">0</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">width</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">0</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag special-attr attr-name" style="color:#00a4db">style</span><span class="token tag special-attr attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag special-attr attr-value punctuation" style="color:#393A34">"</span><span class="token tag special-attr attr-value value css language-css property" style="color:#36acaa">display</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:#393A34">:</span><span class="token tag special-attr attr-value value css language-css" style="color:#e3116c">none</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:#393A34">;</span><span class="token tag special-attr attr-value value css language-css property" style="color:#36acaa">visibility</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:#393A34">:</span><span class="token tag special-attr attr-value value css language-css" style="color:#e3116c">hidden</span><span class="token tag special-attr attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">iframe</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">noscript</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- End Google Tag Manager (noscript) --&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>下一步，我们就可以针对性地进行埋点了。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-建-tag">3. 建 Tag<a href="#3-建-tag" class="hash-link" aria-label="3. 建 Tag的直接链接" title="3. 建 Tag的直接链接">​</a></h2><p>这里是有 Google Analytics（以下称 GA） 处理和分析统计的数据，选择 <code>Google Analytics: Universal Analytics</code> 新建 Tag，如下图：
<img loading="lazy" alt="GTM Tag" src="/assets/images/gtm-tag-a0c99aaabb44a65ca8970427d9e6d4eb.png" width="1266" height="922" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="31-关联-ga-配置">3.1 关联 GA 配置<a href="#31-关联-ga-配置" class="hash-link" aria-label="3.1 关联 GA 配置的直接链接" title="3.1 关联 GA 配置的直接链接">​</a></h3><p>选择 <code>Track Type</code> 选择 <code>Event</code>; <code>Category</code>, <code>Action</code>, <code>Label</code> 的值便于识别即可，<code>Value</code> 建议填 <code>1</code>, 作为单词统计的基数。
<img loading="lazy" alt="GTM Tag Config" src="/assets/images/gtm-tag-config-154ed91d977dbc0336ca893aef9ae3b9.png" width="2538" height="1890" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="32-新建变量">3.2 新建变量<a href="#32-新建变量" class="hash-link" aria-label="3.2 新建变量的直接链接" title="3.2 新建变量的直接链接">​</a></h3><p>然后，需要关联到 GA, 选择 <code>New Variable</code>, 配置 GA 的 Tracking ID （可在 <a href="https://analytics.google.com" target="_blank" rel="noopener noreferrer">https://analytics.google.com</a> 个人管理中找到）。
变量创建一次后可以在侧边栏 <code>Variables</code> 进行管理。
<img loading="lazy" alt="GTM Variable for GA" src="/assets/images/gtm-tag-variable-76ccc08793dc9a8f3b4c611814d572a1.png" width="1434" height="1054" class="img_ev3q"></p><p>命名，保存。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-建-trigger">4. 建 Trigger<a href="#4-建-trigger" class="hash-link" aria-label="4. 建 Trigger的直接链接" title="4. 建 Trigger的直接链接">​</a></h2><p>创建好 Tag 后需要关联 Trigger。举个例子，我想统计阅读 <code>Google Tag Manager</code> 相关文章的 PV 总数，可以选择 <code>Page View</code> 类型的 <code>Track Type</code>, 然后添加一个触发规则，示图如下：</p><p><img loading="lazy" alt="GTM Trigger" src="/assets/images/gtm-trigger-a7a59faaa09c06ab53254c0a60aded68.png" width="2494" height="988" class="img_ev3q"></p><p>追踪类型、触发规则要容易区分我们想要统计的页面或者操作。这个以后再讲。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="5-preview-调试">5. Preview 调试<a href="#5-preview-调试" class="hash-link" aria-label="5. Preview 调试的直接链接" title="5. Preview 调试的直接链接">​</a></h2><p>Tag, Trigger 配置好后，可以点击 “Preview” 开启 Debug 模式进行本地预览。</p><p>预览：
<img loading="lazy" alt="GTM Preview" src="/assets/images/gtm-preview-b41c03d4b18fca3f528f2a4e77461a79.png" width="3202" height="1660" class="img_ev3q"></p><p>本地 Debug 触发的 Trigger &amp; Tag:
<img loading="lazy" alt="GTM Debug" src="/assets/images/gtm-debug-1b1f768ea629e5e3ecf427fcc114923f.png" width="1608" height="1948" class="img_ev3q"></p><p>上报的 Tag 信息：
<img loading="lazy" alt="GTM Debug 2" src="/assets/images/gtm-debug2-1f0fb6e29763cd38628d330b9aa449a6.png" width="1580" height="1318" class="img_ev3q"></p><p>GA 统计到的数据：
<img loading="lazy" alt="GA" src="/assets/images/ga-event-358e23c667032afdff30e2c27aeaf196.png" width="3306" height="1944" class="img_ev3q"></p><p>调试 OK，推出 Debug，准备发布。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="6-发布">6. 发布<a href="#6-发布" class="hash-link" aria-label="6. 发布的直接链接" title="6. 发布的直接链接">​</a></h2><p>Google Tag Manager 提供了便捷的版本管理功能，填写好发布信息提交吧。</p><p>以上，就是一次 GTM 基本应用配置了。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="总结">总结<a href="#总结" class="hash-link" aria-label="总结的直接链接" title="总结的直接链接">​</a></h2><p>Google Tag Manager 中 Tag 和 Trigger 提供的功能十分丰富，需要根据我们自身的统计需求选择配置。
开始或许很复杂，熟悉之后就很方便快捷了，试试看吧。</p>]]></content>
        <category label="Google Tag Manager" term="Google Tag Manager"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Webhooks - 网站自动化部署实践]]></title>
        <id>https://p2yang.github.io/blog/webhooks-deploy</id>
        <link href="https://p2yang.github.io/blog/webhooks-deploy"/>
        <updated>2019-03-18T15:10:03.000Z</updated>
        <summary type="html"><![CDATA[本文记录了使用 Github 的 Webhooks 进行网站自动化部署的实践步骤。]]></summary>
        <content type="html"><![CDATA[<p>本文记录了使用 <code>Github</code> 的 <code>Webhooks</code> 进行网站自动化部署的实践步骤。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="概述">概述<a href="#概述" class="hash-link" aria-label="概述的直接链接" title="概述的直接链接">​</a></h2><p>我们将项目代码托管到 Github 上，为方便服务端更新网站代码，启用 Webhooks 来实现更新服务。</p><p>整个过程分为 4 步：</p><ol><li>自动化 Shell 脚本更新代码;</li><li>Node Server 监听 webhook push 事件;</li><li>pm2 守护 Server 进程</li><li>配置 Github webhooks.</li></ol><p>配置所需：</p><ul><li>shell 脚本</li><li>Node Server</li><li>github-webhook-handler</li><li>pm2</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="自动化-shell-脚本">自动化 Shell 脚本<a href="#自动化-shell-脚本" class="hash-link" aria-label="自动化 Shell 脚本的直接链接" title="自动化 Shell 脚本的直接链接">​</a></h2><blockquote><p>该脚本的目的是在目标服务器上 pull 远程代码以实现迭代更新。</p></blockquote><p>当我们在本地开发测试后，将代码 push 到 Github 上，会触发已配置好的 Webhooks，在目标服务器上执行这段 Shell 脚本。
我们在项目 root 目录下创建 <code>deploy.sh</code> 文件，添加以下内容。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token shebang important">#! /bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 确保脚本抛出遇到的错误</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">set</span><span class="token plain"> -e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> /www/learning-handbook</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> reset --hard origin/master</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> clean -f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> pull</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>实现了 Shell 脚本后，我们需要提供一个 Server 给 Webhooks 调用它。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="node-server-实现更新服务">Node Server 实现更新服务<a href="#node-server-实现更新服务" class="hash-link" aria-label="Node Server 实现更新服务的直接链接" title="Node Server 实现更新服务的直接链接">​</a></h2><p>接下来，我们通过 <code>Nodejs</code> 创建一个 Server 来实现更新服务。
这里我们需要借助 <code>github-webhook-handler</code> 来监听 Github webhooks 的 <code>push</code> 请求，请求成功后通过 <code>child_process</code> 执行上面的 Shell 脚本，就能在服务器上获取更新了。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="server">server<a href="#server" class="hash-link" aria-label="server的直接链接" title="server的直接链接">​</a></h3><p>同样，在项目 root 下创建 <code>webhook.js</code> 代码如下：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> http </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'http'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> spawn </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'child_process'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> createHandler </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'github-webhook-handler'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 下面这个 secret 是你在 github webhook 里设置的 secret 值</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> handler </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createHandler</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">path</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'/deploy'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">secret</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'xxx'</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">PORT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6666</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">http</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">createServer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">req</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> res</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">handler</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">req</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> res</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token parameter">err</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">statusCode</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">404</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">end</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'no such location'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">listen</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">PORT</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">handler</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">on</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'error'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token parameter">err</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'Error:'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">message</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 监听到push事件的时候执行我们的自动化脚本</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">handler</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">on</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'push'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token parameter">event</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'Received a push event for %s to %s'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    event</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">payload</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">repository</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    event</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">payload</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">ref</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">runCommand</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'sh'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'./deploy.sh'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">log</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">runCommand</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> </span><span class="token parameter">cmd</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> args</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> callback</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> response </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">''</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> child </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">spawn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> cmd</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> args </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    child</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">stdout</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">on</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'data'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token parameter">buffer</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> response </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> buffer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">toString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    child</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">stdout</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">on</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'end'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">callback</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">response</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="nginx-反向代理">nginx 反向代理<a href="#nginx-反向代理" class="hash-link" aria-label="nginx 反向代理的直接链接" title="nginx 反向代理的直接链接">​</a></h3><p>配置 nginx 反向代理 <code>/deploy</code></p><div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nginx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">···</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">server {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    listen 80;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server_name handbook.p2yang.com;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ···</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    location /deploy {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_pass http://127.0.0.1:6666;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ···</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="配置-webhook">配置 Webhook<a href="#配置-webhook" class="hash-link" aria-label="配置 Webhook的直接链接" title="配置 Webhook的直接链接">​</a></h2><p>Webhooks 在 Github 项目的 <code>Settings</code> 里。进入其中添加一个新的 webhook，如下图：</p><p><img loading="lazy" alt="Github webhooks" src="/assets/images/github-webhook-f4d95cec3471a40dd0c607f241dc01b9.png" width="1966" height="1398" class="img_ev3q"></p><p>注意，由于我们上面使用的 <code>github-webhook-handler</code> 要求 <code>Content type</code> 必须设置成 <code>application/json</code>。
<code>Payload URL</code> 和 <code>Secret</code> 值与 Server 配置需要保持一致。</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> handler </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createHandler</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">path</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'/deploy'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">secret</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'xxx'</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>当服务全部配置成功后，webhook 的状态如下:</p><p><img loading="lazy" alt="Github webhook push status" src="/assets/images/github-webhook-status-971a46172b14d61ef70d4c0bbf6bc38f.png" width="1570" height="820" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="初次部署">初次部署<a href="#初次部署" class="hash-link" aria-label="初次部署的直接链接" title="初次部署的直接链接">​</a></h2><p>第一次部署，需要先在目标服务器上 git clone 下项目代码。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="pm2-守护">pm2 守护<a href="#pm2-守护" class="hash-link" aria-label="pm2 守护的直接链接" title="pm2 守护的直接链接">​</a></h2><p>这里使用 <code>pm2</code> 来守护 Server 更新服务。基本用法如下：</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="首先全局安装-pm2">首先全局安装 <code>pm2</code>:<a href="#首先全局安装-pm2" class="hash-link" aria-label="首先全局安装-pm2的直接链接" title="首先全局安装-pm2的直接链接">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> pm2 -g</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="启动服务">启动服务:<a href="#启动服务" class="hash-link" aria-label="启动服务:的直接链接" title="启动服务:的直接链接">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pm2 start webhook.js</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="查看服务列表">查看服务列表<a href="#查看服务列表" class="hash-link" aria-label="查看服务列表的直接链接" title="查看服务列表的直接链接">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pm2 list</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="查看日志">查看日志<a href="#查看日志" class="hash-link" aria-label="查看日志的直接链接" title="查看日志的直接链接">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pm2 log </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">服务名或服务id</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="其他">其他<a href="#其他" class="hash-link" aria-label="其他的直接链接" title="其他的直接链接">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pm2 stop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pm2 restart</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pm2 delete</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>大功告成！</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="小结">小结<a href="#小结" class="hash-link" aria-label="小结的直接链接" title="小结的直接链接">​</a></h2><p>能自动的就自动吧，我们的时间可以花在更有趣的事情上！</p>]]></content>
        <category label="node" term="node"/>
        <category label="git" term="git"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Node 图片绘制及合成介绍]]></title>
        <id>https://p2yang.github.io/blog/node-draw-image</id>
        <link href="https://p2yang.github.io/blog/node-draw-image"/>
        <updated>2019-01-17T10:14:09.000Z</updated>
        <summary type="html"><![CDATA[本文主要介绍 Node 图片绘制及合成的一些方式，不涉及图表相关。]]></summary>
        <content type="html"><![CDATA[<p>本文主要介绍 Node 图片绘制及合成的一些方式，不涉及图表相关。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="实践方式">实践方式<a href="#实践方式" class="hash-link" aria-label="实践方式的直接链接" title="实践方式的直接链接">​</a></h2><ol><li><p>node-canvas - 类前端
这里说的 canvas 是 web canvas 的 node 实现。其 api 与 web canvas 高度相似。</p><p>安装：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> canvas</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>gm - node
<code>gm</code> 是通过 node 调用 <code>GraphicsMagick</code> 和 <code>ImageMagick</code> 来实现绘图功能的。其中，GraphicsMagick “短小精悍”，号称是“图像处理领域的瑞士军刀”, 是从 ImageMagick 5.2.2 中独立出来的。
<code>gm</code> 支持链式调用，基本功能类似 canvas api，但更强大。可查看官方文档深入研究。</p><p>使用方法：</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-下载-graphicsmagick-和-imagemagick">(1) 下载 GraphicsMagick 和 ImageMagick<a href="#1-下载-graphicsmagick-和-imagemagick" class="hash-link" aria-label="(1) 下载 GraphicsMagick 和 ImageMagick的直接链接" title="(1) 下载 GraphicsMagick 和 ImageMagick的直接链接">​</a></h4><p>Mac 上可以直接直接使用 <code>Homebrew</code> 下载安装：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">brew </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> imagemagick</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">brew </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> graphicsmagick</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-安装-gm">(2) 安装 gm<a href="#2-安装-gm" class="hash-link" aria-label="(2) 安装 gm的直接链接" title="(2) 安装 gm的直接链接">​</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> gm</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="3-基本使用">(3) 基本使用<a href="#3-基本使用" class="hash-link" aria-label="(3) 基本使用的直接链接" title="(3) 基本使用的直接链接">​</a></h4><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> gm </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'gm'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">gm</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'/path/to/img.jpg'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">font</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'/path/to/font.ttc'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 字体文件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">fontSize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">70</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">fill</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'#ffe600'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">drawText</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">70</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'Hello'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">resize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">200</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">write</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'/path/to/resize.png'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'done'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="一些有意思的-package">一些有意思的 Package<a href="#一些有意思的-package" class="hash-link" aria-label="一些有意思的 Package的直接链接" title="一些有意思的 Package的直接链接">​</a></h3><ul><li><a href="https://github.com/d3/d3" target="_blank" rel="noopener noreferrer">d3</a></li><li><a href="https://github.com/liabru/matter-js" target="_blank" rel="noopener noreferrer">matter-js</a></li><li><a href="https://github.com/a-jie/Proton" target="_blank" rel="noopener noreferrer">Proton</a></li><li><a href="http://paperjs.org" target="_blank" rel="noopener noreferrer">Paper.js</a></li><li><a href="https://github.com/spritejs/spritejs" target="_blank" rel="noopener noreferrer">sprite.js</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="参考链接">参考链接<a href="#参考链接" class="hash-link" aria-label="参考链接的直接链接" title="参考链接的直接链接">​</a></h2><ul><li><a href="https://github.com/Automattic/node-canvas" target="_blank" rel="noopener noreferrer">node-canvas</a></li><li><a href="https://github.com/aheckmann/gm" target="_blank" rel="noopener noreferrer">gm</a></li><li><a href="http://www.graphicsmagick.org/" target="_blank" rel="noopener noreferrer">GraphicsMagick</a></li></ul>]]></content>
        <category label="node" term="node"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[iOS Simulator 模拟器 - web 页面调试实践]]></title>
        <id>https://p2yang.github.io/blog/simulator-dev</id>
        <link href="https://p2yang.github.io/blog/simulator-dev"/>
        <updated>2018-11-06T16:06:40.000Z</updated>
        <summary type="html"><![CDATA[低版本 iOS safari 如何调试？在真机难求的情况下，可以用 Mac iOS Simulator 进行调试。]]></summary>
        <content type="html"><![CDATA[<p>低版本 iOS safari 如何调试？在真机难求的情况下，可以用 Mac <code>iOS Simulator</code> 进行调试。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="操作步骤">操作步骤<a href="#操作步骤" class="hash-link" aria-label="操作步骤的直接链接" title="操作步骤的直接链接">​</a></h2><ol><li><p>安装下载 Xcode
在 App Store 中搜索 Xcode 下载安装。</p><p>说明：本文基于 Xcode 10.1 创作。</p></li><li><p>打开 Simulator
依次选择菜单栏: <code>Xcode -&gt; Open Developer Tool -&gt; Simulator</code>，如图：</p><p><img loading="lazy" src="/assets/images/open-9e57d50d5edd036bd647752a8a8264e6.png" width="1520" height="682" class="img_ev3q"></p><p>经过初始化后，出现如下界面:</p><p><img loading="lazy" src="/assets/images/device-e08a63da26053e84732e1554df0f409a.png" width="978" height="1550" class="img_ev3q"></p><p>可以打开菜单栏: <code>Hardware -&gt; Device</code> 选择切换成你想要的系统版本、设备类型。</p></li><li><p>调试
我们用 Mac 上的 Safari 开发者工具进行调试。</p><p>首先打开 Simulator 中的 Safari, 访问目标 web 页面。</p><p>然后打开 mac 上的 Safari，选择 <code>开发 -&gt; 模拟器 -&gt; 目标url</code> 即可打开对应的开发者工具进行调试。
（如没有<code>开发</code>菜单，请从 Safari 偏好设置里启用此功能。）</p><p><img loading="lazy" src="/assets/images/dev-d260a7f7979e81b2e8cef7307f96c9f6.png" width="2002" height="1062" class="img_ev3q"></p></li><li><p>选择系统版本
默认的 Simulator 支持的 iOS 版本只有一个，此时，我们需要手动到 Xcode 里下载想要的 iOS 版本。</p><p>依次打开 <code>Xcode -&gt; Preferences -&gt; Components</code> ，下载目标版本，完成之后重新打开 Simulator，就能从 <code>Hardware</code> 里进行切换了。</p><p><img loading="lazy" src="/assets/images/components-10a550f1a5f07d5d5a024cd90df80504.png" width="1600" height="1096" class="img_ev3q"></p></li></ol><p>以上，就是用 iOS Simulator 调试的基本过程。</p>]]></content>
        <category label="Tool" term="Tool"/>
        <category label="ios" term="ios"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Canvas 跨域脱坑实践]]></title>
        <id>https://p2yang.github.io/blog/canvas-to-img</id>
        <link href="https://p2yang.github.io/blog/canvas-to-img"/>
        <updated>2018-11-02T14:35:29.000Z</updated>
        <summary type="html"><![CDATA[Canvas 跨域如何解决？这里记录下使用 Canvas 绘图过程中所遇到的跨域问题和解决方案。]]></summary>
        <content type="html"><![CDATA[<p><code>Canvas</code> 跨域如何解决？这里记录下使用 <code>Canvas</code> 绘图过程中所遇到的跨域问题和解决方案。</p><p>先来看下实现方法。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="实现方法">实现方法<a href="#实现方法" class="hash-link" aria-label="实现方法的直接链接" title="实现方法的直接链接">​</a></h2><p>目标图片一般是由 图片 + 文本 构成。无论是千奇百怪的大小图片，还是变幻莫测的各式文本，都能用 <code>canvas</code> api <code>drawImage</code> 和 <code>fillText</code> 方法来完成。</p><p>基本流程如下:</p><ol><li><p>获取 <code>canvas</code> 上下文 -- <code>ctx</code></p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> canvas </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">querySelector</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">selector</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> ctx </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> canvas</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getContext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'2d'</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>绘图
忽略图片上的内容，直接用 <code>drawImage</code> 将其画到 <code>canvas</code> 画布上即可。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">```js</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const image = new Image()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">image.src = src</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">image.onload = () =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ctx.save()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 这里我们采用以下参数调用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    this.ctx.drawImage(image, dx, dy, dWidth, dHeight)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    this.ctx.restore()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">`drawImage` 有3种参数使用方式，具体用法可以查看 [MDN 文档](https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/drawImage)。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>获取图像数据
调用 <code>HTMLCanvasElement</code> DOM 对象提供的 <code>toBlob()</code>, <code>toDataURL()</code> 或 <code>getImageData()</code> 方法，即可。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">```js</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">canvas.toBlob(blob =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 你要的 blob</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}, mimeType, encoderOptions)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">这里的 `mimeType` 默认值为 `image/png`。`encoderOptions` 指定了图片质量，可用于压缩，不过需要 `mimeType` 格式为 `image/jpeg` 或者 `image/webp`。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="canvas-跨域">Canvas 跨域<a href="#canvas-跨域" class="hash-link" aria-label="Canvas 跨域的直接链接" title="Canvas 跨域的直接链接">​</a></h2><p>正常情况下，如果需要将绘制好的图像输出，我们可以调用 <code>canvas</code> 的 <code>toBlob()</code>, <code>toDataURL()</code> 或 <code>getImageData()</code> 方法来获取到图像数据。然而，遇到图片跨域的情况就有些尴尬了。可能回报如下错误:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Failed to execute 'toBlob' on 'HTMLCanvasElement': Tainted canvases may not be exported.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>或者</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Access to image at 'https://your.image.src' from origin 'https://your.website' has been blocked by CORS policy: No 'Access-Control-Allow-Origin' header is present on the requested resource.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>先来看看第2种情况。</p><ul><li><p><code>Access-Control-Allow-Origin</code>
如果你跨域使用某些图片资源，并且该服务未正确响应 <code>Access-Control-Allow-Origin</code> 头信息, 则会报出如下错误信息:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Access to image at 'https://your.image.src' from origin 'https://your.website' has been blocked by CORS policy: No 'Access-Control-Allow-Origin' header is present on the requested resource.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>说明不允许跨域访问，那么你可以试着让后台修改 <code>Access-Control-Allow-Origin</code> 的值为 <code>*</code> 或 <code>your.website</code>, 或者改用同域资源（考虑下？）。</p></li></ul><p>接下来，我们来解决第1种情况。</p><ul><li><p><code>img.crossOrigin = 'Anonymous'</code>
为避免未经许可拉取远程网站信息而导致的用户隐私泄露（如 GPS 等信息，具体可搜索 Exif），在调用 <code>canvas</code> 的 <code>toBlob()</code>, <code>toDataURL()</code> 或 <code>getImageData()</code> 会抛出安全错误:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Failed to execute 'toBlob' on 'HTMLCanvasElement': Tainted canvases may not be exported.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果你的图片服务允许跨域使用（如果不允许，见上条），那么你该考虑下给 img 元素加上 <code>crossOrigin</code> 属性，即：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> image </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Image</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">image</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">crossOrigin</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'Anonymous'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">image</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">src</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> src</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul><p>如此，你便可以拿到图片数据了。如果没招，换同域资源吧～</p>]]></content>
        <category label="Canvas" term="Canvas"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Google Robots]]></title>
        <id>https://p2yang.github.io/blog/google-robots</id>
        <link href="https://p2yang.github.io/blog/google-robots"/>
        <updated>2018-09-12T19:33:04.000Z</updated>
        <summary type="html"><![CDATA[如果不想 Google 爬虫抓取某个页面，可以考虑添加 robots.txt 文件进行选择性屏蔽。]]></summary>
        <content type="html"><![CDATA[<p>如果不想 Google 爬虫抓取某个页面，可以考虑添加 <code>robots.txt</code> 文件进行选择性屏蔽。</p><blockquote><p><code>robots.txt</code> 文件位于您网站的根目录下，用于表明您不希望搜索引擎抓取工具访问您网站上的哪些内容。--- Google</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="一个示例">一个示例<a href="#一个示例" class="hash-link" aria-label="一个示例的直接链接" title="一个示例的直接链接">​</a></h3><p>将 <code>robots.txt</code> 添加到网站根目录下，示例如下</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">User-agent: *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Disallow: /particles</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Allow: /</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 本站暂时还未添加 sitemap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Sitemap: http://www.p2yang.com/sitemap.xml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="语法">语法<a href="#语法" class="hash-link" aria-label="语法的直接链接" title="语法的直接链接">​</a></h3><blockquote><p>robots.txt 文件中使用了以下关键字：</p><ul><li>User-agent：<!-- -->[必需，每条规则需要一个或多个]<!-- --> 此条规则所要应用到的搜索引擎“漫游器”（即网页抓取工具软件）的名称。Web Robots Database 和 Google 用户代理列表中列出了大多数用户代理名称。支持使用星号 (<!-- -->*<!-- -->) 通配符表示路径前缀、后缀或整个字符串。像下例中那样使用星号 (<!-- -->*<!-- -->) 可匹配所有抓取工具（各种 AdsBot 抓取工具除外，此类抓取工具必须明确指定）。（查看 Google 抓取工具名称列表。）</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Block all but AdsBot crawlers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">User-agent: *</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Disallow：<!-- -->[每条规则需要至少一个或多个 Disallow 或 Allow 条目]<!-- --> 用户代理不应抓取的目录或网页（以相对于根网域的路径表示）。如果要指定网页，就应提供浏览器中显示的完整网页名称；如果要指定目录，则应以 / 标记结尾。支持使用星号 (<!-- -->*<!-- -->) 通配符表示路径前缀、后缀或整个字符串。</li><li>Allow：<!-- -->[每条规则需要至少一个或多个 Disallow 或 Allow 条目]<!-- --> 上文中提到的用户代理应抓取的目录或网页（以相对于根网域的路径表示）。此指令用于替换 Disallow 指令，从而允许抓取已禁止访问的目录中的子目录或网页。如果要指定网页，就应提供浏览器中显示的完整网页名称；如果要指定目录，则应以 / 标记结尾。支持使用星号 (<!-- -->*<!-- -->) 通配符表示路径前缀、后缀或整个字符串。</li></ul></blockquote><blockquote><ul><li>Sitemap：<!-- -->[可选，每个文件可包含零个或多个]<!-- --> 相应网站的站点地图的位置。此行不是必需的，您可酌情指定多个站点地图，并使用换行符分隔各个站点地图。站点地图是一种用于指示 Google 应抓取哪些内容的理想方式，但并不用于指示 Google 可以抓取或不能抓取哪些内容。详细了解站点地图。</li></ul></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="有效性测试">有效性测试<a href="#有效性测试" class="hash-link" aria-label="有效性测试的直接链接" title="有效性测试的直接链接">​</a></h3><p>发布后可使用官方提供的<a href="https://support.google.com/webmasters/answer/6062598?hl=zh-Hans&amp;ref_topic=6061961" target="_blank" rel="noopener noreferrer">工具</a>进行测试。</p><p>实际效果如下：
<img loading="lazy" src="/assets/images/google-robots-4b181bada59d5c58c48fbbedf5bbc321.png" width="2864" height="1542" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="参考链接">参考链接<a href="#参考链接" class="hash-link" aria-label="参考链接的直接链接" title="参考链接的直接链接">​</a></h3><ol><li><a href="https://support.google.com/webmasters/answer/6062596?hl=zh-Hans&amp;ref_topic=6061961" target="_blank" rel="noopener noreferrer">Google官方文档</a></li></ol>]]></content>
        <category label="Tools" term="Tools"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[webpack profile 文件分析功能]]></title>
        <id>https://p2yang.github.io/blog/webpack-profile-stats</id>
        <link href="https://p2yang.github.io/blog/webpack-profile-stats"/>
        <updated>2018-07-25T10:27:47.000Z</updated>
    </entry>
    <entry>
        <title type="html"><![CDATA[Sublime Text 实用插件]]></title>
        <id>https://p2yang.github.io/blog/sublime-text-plugins</id>
        <link href="https://p2yang.github.io/blog/sublime-text-plugins"/>
        <updated>2018-05-21T19:04:05.000Z</updated>
        <summary type="html"><![CDATA[本文是对 Sublime Text 编辑器一些实用插件的总结，可以参考下。]]></summary>
        <content type="html"><![CDATA[<p>本文是对 Sublime Text 编辑器一些实用插件的总结，可以参考下。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="说明">说明<a href="#说明" class="hash-link" aria-label="说明的直接链接" title="说明的直接链接">​</a></h2><p>想装插件，请先开启 <code>Package Control</code>, 网上教程很多，本文不做赘述。</p><p>所有支持的插件可以从<a href="https://packagecontrol.io/" target="_blank" rel="noopener noreferrer">packagecontrol.io</a>上找到。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="sync-settings----配置云同步">Sync Settings -- 配置云同步<a href="#sync-settings----配置云同步" class="hash-link" aria-label="Sync Settings -- 配置云同步的直接链接" title="Sync Settings -- 配置云同步的直接链接">​</a></h2><p>最简单的、省事儿、安全的方法当然是“拿来主义”了。这个插件可以将你的配置上传到<a href="https://gist.github.com/" target="_blank" rel="noopener noreferrer"><code>Gist</code></a>上，也可以将<code>Gist</code>上的配置同步到本地。也就是说，你可以直接获取别人分享的配置。注意这些配置包括了插件、快捷键、个性化配置等。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="sidebarenhancements----侧边栏增强">SideBarEnhancements -- 侧边栏增强<a href="#sidebarenhancements----侧边栏增强" class="hash-link" aria-label="SideBarEnhancements -- 侧边栏增强的直接链接" title="SideBarEnhancements -- 侧边栏增强的直接链接">​</a></h2><p>默认的侧边栏功能极简，使用该插件应该能满足需求。</p><p><img loading="lazy" src="/assets/images/sidebar-8e032538dc8b26b94d375ff6daeb89f7.png" width="994" height="1686" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="sublimecodeintel----代码提示">SublimeCodeIntel -- 代码提示<a href="#sublimecodeintel----代码提示" class="hash-link" aria-label="SublimeCodeIntel -- 代码提示的直接链接" title="SublimeCodeIntel -- 代码提示的直接链接">​</a></h2><p>这个就不用说了吧，效率必备。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="sublimelinter----代码校验">SublimeLinter -- 代码校验<a href="#sublimelinter----代码校验" class="hash-link" aria-label="SublimeLinter -- 代码校验的直接链接" title="SublimeLinter -- 代码校验的直接链接">​</a></h2><p>配合以下两个插件，可以对文件进行 <code>Eslint</code> 规则校验，让代码更漂亮、风格更统一。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="sublimelinter-eslint----eslint-语法校验">SublimeLinter-eslint -- Eslint 语法校验<a href="#sublimelinter-eslint----eslint-语法校验" class="hash-link" aria-label="SublimeLinter-eslint -- Eslint 语法校验的直接链接" title="SublimeLinter-eslint -- Eslint 语法校验的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_LWe7" id="sublimelinter-json----json-检测">SublimeLinter-json -- JSON 检测<a href="#sublimelinter-json----json-检测" class="hash-link" aria-label="SublimeLinter-json -- JSON 检测的直接链接" title="SublimeLinter-json -- JSON 检测的直接链接">​</a></h3><h2 class="anchor anchorWithStickyNavbar_LWe7" id="eslint-formatter----eslint-fix">ESLint-Formatter -- Eslint fix<a href="#eslint-formatter----eslint-fix" class="hash-link" aria-label="ESLint-Formatter -- Eslint fix的直接链接" title="ESLint-Formatter -- Eslint fix的直接链接">​</a></h2><p>将不符合规则的代码格式化，不过，只能格式化简单的规则，如标点符号。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="git">Git<a href="#git" class="hash-link" aria-label="Git的直接链接" title="Git的直接链接">​</a></h2><p>应该要装吧。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="gitgutter----显示git信息">Git​Gutter -- 显示git信息<a href="#gitgutter----显示git信息" class="hash-link" aria-label="Git​Gutter -- 显示git信息的直接链接" title="Git​Gutter -- 显示git信息的直接链接">​</a></h2><p>看图：</p><p><img loading="lazy" src="/assets/images/gitgutter1-6a44a1fe65e697d88144072e7195262b.gif" width="704" height="346" class="img_ev3q"></p><p><img loading="lazy" src="/assets/images/gitgutter2-701f68d2a194425bce2c8bc7ae362bf8.gif" width="597" height="346" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="git-blame----git-历史问责">Git blame -- Git 历史问责<a href="#git-blame----git-历史问责" class="hash-link" aria-label="Git blame -- Git 历史问责的直接链接" title="Git blame -- Git 历史问责的直接链接">​</a></h2><p><code>vscode</code> 上有个<code>Gitlens</code>，可以在每行代码上显示上一次的<code>Git</code>提交记录。<code>Sublime Text</code> 上的 <code>Git blame</code> 同样可以实现此功能。代码责任到行，从此，不用担心甩锅（当然啦，可以查看具体的文件commit history）。该插件提供了快速查看某行或某文件上次修改历史记录的功能，十分方便。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="color-highlighter----颜色高亮">Color Highlighter -- 颜色高亮<a href="#color-highlighter----颜色高亮" class="hash-link" aria-label="Color Highlighter -- 颜色高亮的直接链接" title="Color Highlighter -- 颜色高亮的直接链接">​</a></h2><p><img loading="lazy" src="/assets/images/colorhighlighte-4adc09ea3ab04d0d4484131e400e6f89.png" width="672" height="626" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="case-conversion----格式转换">Case Conversion -- 格式转换<a href="#case-conversion----格式转换" class="hash-link" aria-label="Case Conversion -- 格式转换的直接链接" title="Case Conversion -- 格式转换的直接链接">​</a></h2><p>将选中文本转换成目标格式，如 <code>snake_case</code>, <code>SCREAMING_SNAKE_CASE</code>, <code>camelCase</code>, <code>PascalCase</code>, <code>dot.case</code>等。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="docblockr----添加注释">DocBlockr -- 添加注释<a href="#docblockr----添加注释" class="hash-link" aria-label="DocBlockr -- 添加注释的直接链接" title="DocBlockr -- 添加注释的直接链接">​</a></h2><p><img loading="lazy" src="/assets/images/docblockr-9be1f67768596c6e3671bc157c1fa544.gif" width="368" height="192" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="主题配色">主题配色<a href="#主题配色" class="hash-link" aria-label="主题配色的直接链接" title="主题配色的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="spacegray">Spacegray<a href="#spacegray" class="hash-link" aria-label="Spacegray的直接链接" title="Spacegray的直接链接">​</a></h3><ol><li><p>白色</p><p><img loading="lazy" src="/assets/images/spacegray1-c541522a786d38dbcd508b20f21bd801.png" width="1788" height="1600" class="img_ev3q"></p></li><li><p>黑色</p><p><img loading="lazy" src="/assets/images/spacegray2-190cac6319d5f5c303939f59c9f740fb.png" width="1788" height="1600" class="img_ev3q"></p></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="material">Material<a href="#material" class="hash-link" aria-label="Material的直接链接" title="Material的直接链接">​</a></h3><p><img loading="lazy" src="/assets/images/material-92442f8c8ca7c6cd873c8da367bc870b.gif" width="1600" height="1200" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="结语">结语<a href="#结语" class="hash-link" aria-label="结语的直接链接" title="结语的直接链接">​</a></h2><p>详细安装使用教程都可以在 <a href="https://packagecontrol.io/" target="_blank" rel="noopener noreferrer">packagecontrol.io</a> 上找到，以上部分截图也是取自官方文档。暂时先记录到这里吧。</p>]]></content>
        <category label="Sublime Text" term="Sublime Text"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Node API - URL]]></title>
        <id>https://p2yang.github.io/blog/node-url</id>
        <link href="https://p2yang.github.io/blog/node-url"/>
        <updated>2018-05-15T09:33:10.000Z</updated>
        <summary type="html"><![CDATA[URL 提供了一系列 url 解析和处理方法。]]></summary>
        <content type="html"><![CDATA[<p><code>URL</code> 提供了一系列 url 解析和处理方法。</p><p>说明：本文是基于 <a href="mailto:node@9.3.0" target="_blank" rel="noopener noreferrer">node@9.3.0</a> 整理。 查看<a href="https://nodejs.org/docs/v9.3.0/api/url.html" target="_blank" rel="noopener noreferrer">官方文档</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="两种实践">两种实践<a href="#两种实践" class="hash-link" aria-label="两种实践的直接链接" title="两种实践的直接链接">​</a></h2><p>Node <code>url</code> 有两种实现实践形式。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="一-whatwg-url-标准">一. WHATWG URL 标准<a href="#一-whatwg-url-标准" class="hash-link" aria-label="一. WHATWG URL 标准的直接链接" title="一. WHATWG URL 标准的直接链接">​</a></h3><p>在 WHATWG 标准规范中定义了一个 <code>URL</code> 类，<code>new</code> 出一个示例后，就可以得到一系列解析值。如下：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">URL</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'url'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> parsedUrl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">URL</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'https://user:pass@sub.host.com:8080/p/a/t/h?query=string#hash'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol><li><p>属性</p><p>得到的 <code>parsedUrl</code> 对象如下：</p><div class="language-node codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-node codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  href: 'https://user:pass@sub.host.com:8080/p/a/t/h?query=string#hash',</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  origin: 'https://sub.host.com:8080',</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  protocol: 'https:',</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  username: 'user',</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  password: 'pass',</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  host: 'sub.host.com:8080',</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  hostname: 'sub.host.com',</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  port: '8080',</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  pathname: '/p/a/t/h',</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  search: '?query=string',</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  searchParams: URLSearchParams { 'query' =&gt; 'string' },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  hash: '#hash'</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>上面这些属性都可以通过setter的方式赋值改写，如：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">URL</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'url'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> myURL </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">URL</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'https://example.org'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">myURL</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">protocol</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Prints https:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">myURL</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">protocol</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'ftp'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">myURL</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">href</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Prints ftp://example.org/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>方法</p></li></ol><ul><li><p>url.format(url<!-- -->[, options]<!-- -->)</p></li><li><p>url.domainToUnicode(domain)</p></li><li><p>url.domainToASCII(domain)</p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="二-node-自实现">二. Node 自实现<a href="#二-node-自实现" class="hash-link" aria-label="二. Node 自实现的直接链接" title="二. Node 自实现的直接链接">​</a></h3><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> url </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'url'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> parsedUrl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> url</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">parse</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'https://user:pass@sub.host.com:8080/p/a/t/h?query=string#hash'</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>解析结果如下：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">protocol</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'https:'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">slashes</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">auth</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'user:pass'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">host</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'sub.host.com:8080'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">port</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'8080'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">hostname</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'sub.host.com'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">hash</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'#hash'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">search</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'?query=string'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">query</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'query=string'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">pathname</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'/p/a/t/h'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">path</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'/p/a/t/h?query=string'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">href</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'https://user:pass@sub.host.com:8080/p/a/t/h?query=string#hash'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol><li><p>urlObject 对象
<code>url.parse</code> 方法解析后会返回一个 <code>urlObject</code> 对象，对象上即存在众多解析得到的属性值，示例如上所示。</p></li><li><p>方法</p></li></ol><ul><li><p>url.format(urlObject)</p></li><li><p>url.parse(urlString[, parseQueryString<!-- -->[, slashesDenoteHost]<!-- -->])</p></li><li><p>url.resolve(from, to)</p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="urlsearchparams-类">URLSearchParams 类<a href="#urlsearchparams-类" class="hash-link" aria-label="URLSearchParams 类的直接链接" title="URLSearchParams 类的直接链接">​</a></h2><p>主要用于处理 <code>query</code> 字符串。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="简单示例">简单示例<a href="#简单示例" class="hash-link" aria-label="简单示例的直接链接" title="简单示例的直接链接">​</a></h3><p>参数可以是 <code>string</code>、<code>object</code>、<code>iterable</code>。简要示例如下，具体可以查看文档。</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token maybe-class-name">URLSearchParams</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'url'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> params</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">params </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">URLSearchParams</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'user=abc&amp;query=xyz'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">params</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'user'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Prints 'abc'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">params</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">toString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Prints 'user=abc&amp;query=xyz'</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>注意：参数中的 <code>?</code> 会被忽略。</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// object</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token maybe-class-name">URLSearchParams</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'url'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> params </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">URLSearchParams</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">user</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'abc'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">query</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'first'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'second'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">params</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getAll</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'query'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Prints [ 'first,second' ]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">params</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">toString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Prints 'user=abc&amp;query=first%2Csecond'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// ...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">params </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">URLSearchParams</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'user'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'abc'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'query'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'first'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'query'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'second'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">params</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">toString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Prints 'user=abc&amp;query=first&amp;query=second'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// ...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="一些方法">一些方法<a href="#一些方法" class="hash-link" aria-label="一些方法的直接链接" title="一些方法的直接链接">​</a></h3><p>返回的对象具有通行的 ES6 对象方法，<code>toString</code></p><ol><li><p>ES6 对象方法
<code>entries</code>、<code>keys</code>、<code>values</code></p></li><li><p>数组方法
<code>forEach</code>、<code>sort</code></p></li><li><p>其他
<code>set</code>, <code>get</code>, <code>getAll</code>, <code>delete</code>, <code>append</code>, <code>has</code>, <code>toString</code></p></li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="结语">结语<a href="#结语" class="hash-link" aria-label="结语的直接链接" title="结语的直接链接">​</a></h2><p>很实用的工具。以上。</p>]]></content>
        <category label="node" term="node"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[白用了那么多年的 ‘oh-my-zsh’ -- Plugins]]></title>
        <id>https://p2yang.github.io/blog/zsh</id>
        <link href="https://p2yang.github.io/blog/zsh"/>
        <updated>2018-03-22T19:02:56.000Z</updated>
        <summary type="html"><![CDATA[以前虽然研究过 Oh My Zsh 的使用技巧，但都是在需求的驱动下进行的。换过多次主题，配过 Sublime Text 和 Git 等 alias命令，还有一些零散的配置。今天偶然看到其可以开启 web-search 功能，十分惊喜和好奇。浏览过官方 wiki 后，才发现有一些很实用的 plugins, 便记录下折腾过程吧。]]></summary>
        <content type="html"><![CDATA[<p>以前虽然研究过 <code>Oh My Zsh</code> 的使用技巧，但都是在需求的驱动下进行的。换过多次主题，配过 Sublime Text 和 Git 等 alias命令，还有一些零散的配置。今天偶然看到其可以开启 web-search 功能，十分惊喜和好奇。浏览过官方 wiki 后，才发现有一些很实用的 plugins, 便记录下折腾过程吧。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="启动画面">启动画面<a href="#启动画面" class="hash-link" aria-label="启动画面的直接链接" title="启动画面的直接链接">​</a></h3><p>先来看一个启动画面：</p><p><img loading="lazy" src="/assets/images/fbi-f8851ad01999a58c9c4458d252c86a76.png" width="2852" height="512" class="img_ev3q"></p><p>哈哈，是不是有一种陌生的熟悉感！</p><p>如何配置呢？</p><ol><li>打开 .zshrc 配置文件</li></ol><div class="language-zsh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-zsh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vim ~/.zshrc</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>加入一下配置</li></ol><div class="language-zsh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-zsh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">export PATH="$PATH:$HOME/.rvm/bin" # Add RVM to PATH for scripting</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">_COLUMNS=$(tput cols)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">_MESSAGE=" FBI Warining "</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">y=$(( ( $_COLUMNS - ${#_MESSAGE} )  / 2 ))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spaces=$(printf "%-${y}s" " ")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo " "</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo -e "${spaces}\033[41;37;5m FBI WARNING \033[0m"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo " "</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">_COLUMNS=$(tput cols)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">_MESSAGE="Ferderal Law provides severe civil and criminal penalties for"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">y=$(( ( $_COLUMNS - ${#_MESSAGE} )  / 2 ))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spaces=$(printf "%-${y}s" " ")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo -e "${spaces}${_MESSAGE}"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">_COLUMNS=$(tput cols)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">_MESSAGE="the unauthorized reproduction, distribution, or exhibition of"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">y=$(( ( $_COLUMNS - ${#_MESSAGE} )  / 2 ))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spaces=$(printf "%-${y}s" " ")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo -e "${spaces}${_MESSAGE}"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">_COLUMNS=$(tput cols)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">_MESSAGE="copyrighted motion pictures (Title 17, United States Code,"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">y=$(( ( $_COLUMNS - ${#_MESSAGE} )  / 2 ))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spaces=$(printf "%-${y}s" " ")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo -e "${spaces}${_MESSAGE}"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">_COLUMNS=$(tput cols)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">_MESSAGE="Sections 501 and 508). The Federal Bureau of Investigation"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">y=$(( ( $_COLUMNS - ${#_MESSAGE} )  / 2 ))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spaces=$(printf "%-${y}s" " ")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo -e "${spaces}${_MESSAGE}"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">_COLUMNS=$(tput cols)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">_MESSAGE="investigates allegations of criminal copyright infringement"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">y=$(( ( $_COLUMNS - ${#_MESSAGE} )  / 2 ))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spaces=$(printf "%-${y}s" " ")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo -e "${spaces}${_MESSAGE}"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">_COLUMNS=$(tput cols)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">_MESSAGE="(Title 17, United States Code, Section 506)."</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">y=$(( ( $_COLUMNS - ${#_MESSAGE} )  / 2 ))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spaces=$(printf "%-${y}s" " ")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo -e "${spaces}${_MESSAGE}"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo " "</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li>应用生效
执行命令：</li></ol><div class="language-zsh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-zsh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">source ~/.zshrc</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>打开新的 shell 即可看到启动动画了。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="添加-plugins">添加 Plugins<a href="#添加-plugins" class="hash-link" aria-label="添加 Plugins的直接链接" title="添加 Plugins的直接链接">​</a></h3><p>Oh My Zsh 内置了许多 Plugins, 直接添加配置即可。</p><p>修改 <code>~/.zshrc</code> 里的 plugin 属性，其默认值如下：</p><div class="language-zsh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-zsh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">plugins=(git)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>只需要在括号里以空格隔开添加 plugin 名即可，如</p><div class="language-zsh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-zsh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">plugins=(git sublime web-search docker encode64 npm yarn node)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>默认支持的 plugins 可以查看 <a href="https://github.com/robbyrussell/oh-my-zsh/wiki/Plugins" target="_blank" rel="noopener noreferrer">官方wiki</a>，描述很详细。</p><p>其中， <code>web-search</code> 添加了几种搜索命令，如 google, bing, baidu, github 等, 支持从终端进行搜索，如：</p><div class="language-zsh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-zsh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">google oh my zsh 是个啥</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>执行该命令，会自动打开浏览器并搜索目标。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="结语">结语<a href="#结语" class="hash-link" aria-label="结语的直接链接" title="结语的直接链接">​</a></h3><p>保持好奇，总会发现许多有意思的东西，至于其作用，已经不重要了。毕竟，我们已经收获了探索的乐趣！</p>]]></content>
        <category label="Terminal" term="Terminal"/>
        <category label="Tool" term="Tool"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Gogs + Docker 搭建 Git 服务器实践]]></title>
        <id>https://p2yang.github.io/blog/docker-gogs</id>
        <link href="https://p2yang.github.io/blog/docker-gogs"/>
        <updated>2018-03-07T12:59:00.000Z</updated>
        <summary type="html"><![CDATA[本文是用 Gogs Docker 镜像快速搭建自己的 Git 服务器实践记录。]]></summary>
        <content type="html"><![CDATA[<p>本文是用 Gogs Docker 镜像快速搭建自己的 Git 服务器实践记录。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="基本说明">基本说明<a href="#基本说明" class="hash-link" aria-label="基本说明的直接链接" title="基本说明的直接链接">​</a></h3><p>此次实践以 <code>Docker</code> 为主，以 <code>systemd</code> 守护进程。</p><p>相关文档</p><ul><li><a href="https://github.com/gogits/gogs/tree/master/docker" target="_blank" rel="noopener noreferrer">Docker for Gogs</a></li><li><a href="https://gogs.io/docs/" target="_blank" rel="noopener noreferrer">Gogs官方文档</a></li><li><a href="https://docs.docker.com/" target="_blank" rel="noopener noreferrer">Docker官方文档</a></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="安装">安装<a href="#安装" class="hash-link" aria-label="安装的直接链接" title="安装的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="拉取镜像">拉取镜像<a href="#拉取镜像" class="hash-link" aria-label="拉取镜像的直接链接" title="拉取镜像的直接链接">​</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> pull gogs/gogs</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="创建本地资源文件">创建本地资源文件<a href="#创建本地资源文件" class="hash-link" aria-label="创建本地资源文件的直接链接" title="创建本地资源文件的直接链接">​</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> -p /var/gogs</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="配置-service-文件">配置 service 文件<a href="#配置-service-文件" class="hash-link" aria-label="配置 service 文件的直接链接" title="配置 service 文件的直接链接">​</a></h4><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[Unit]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Description=gogs service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">After=docker.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Requires=docker.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[Service]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TimeoutStartSec=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Restart=always</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ExecStartPre=-/usr/bin/docker rm gogs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ExecStart=/usr/bin/docker run \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   --name gogs \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   -v /var/gogs:/data/ \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   -p 10022:22 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   -p 10080:3000 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   gogs/gogs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ExecStop=/usr/bin/docker kill gogs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[Install]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WantedBy=multi-user.target</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="启动服务">启动服务<a href="#启动服务" class="hash-link" aria-label="启动服务的直接链接" title="启动服务的直接链接">​</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">systemctl start gogs</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>至此，安装启动完成，访问 10080 端口即可！</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置">配置<a href="#配置" class="hash-link" aria-label="配置的直接链接" title="配置的直接链接">​</a></h3><p>访问 <code>http://ip:port</code> 配置gogs服务。</p><p>主要是配置 <code>数据库</code>、<code>域名</code>、<code>应用地址</code>。根据个人情况配置如下，其他默认：
数据库：SQLite3
域名：git.p2yang.com
应用地址：<a href="http://git.p2yang.com" target="_blank" rel="noopener noreferrer">http://git.p2yang.com</a></p><p>访问 git.p2yang.com:10080， 结果如图所示
<img loading="lazy" alt="gogs" src="/assets/images/gogs-a66d1c3d353f669ffd9f97d5617b8dff.png" width="2494" height="1620" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置nginx反向代理">配置nginx反向代理<a href="#配置nginx反向代理" class="hash-link" aria-label="配置nginx反向代理的直接链接" title="配置nginx反向代理的直接链接">​</a></h3><p>nginx 增加配置如下：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">server {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server_name git.p2yang.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    listen 80;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    location / {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_pass http://139.196.54.203:10080;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_set_header Host $host:80;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_set_header X-Real-IP $remote_addr;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>监听<code>80</code>端口，代理到服务器<code>10080</code>端口。</p><ul><li>注意：如果是<code>nginx + docker</code> 容器起的服务，此处 <code>proxy_pass</code> 的值须采用<code>ip</code>.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="备份">备份<a href="#备份" class="hash-link" aria-label="备份的直接链接" title="备份的直接链接">​</a></h3><p>实现中...</p>]]></content>
        <category label="git" term="git"/>
        <category label="docker" term="docker"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[parcel-vue环境下pug支持实践]]></title>
        <id>https://p2yang.github.io/blog/parcel-vue-pug</id>
        <link href="https://p2yang.github.io/blog/parcel-vue-pug"/>
        <updated>2018-01-30T09:18:42.000Z</updated>
        <summary type="html"><![CDATA[parcel-plugin-vue 插件默认没有实现此功能，需要我们自己写配置。其默认转换工具是 vueify, 根据文档资料，本文记录下实现 pug 支持的基本步骤。]]></summary>
        <content type="html"><![CDATA[<p><code>parcel-plugin-vue</code> 插件默认没有实现此功能，需要我们自己写配置。其默认转换工具是 <code>vueify</code>, 根据文档资料，本文记录下实现 pug 支持的基本步骤。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="添加配置文件-vueconfigjs">添加配置文件 <strong><em>vue.config.js</em></strong><a href="#添加配置文件-vueconfigjs" class="hash-link" aria-label="添加配置文件-vueconfigjs的直接链接" title="添加配置文件-vueconfigjs的直接链接">​</a></h2><p>在根目录下新建配置文件 <strong><em>vue.config.js</em></strong>，添加pug解析方法，具体如下：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// vue.config.js</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> pug </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'pug'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">module</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">customCompilers</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">pug</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">content</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> cb</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> html </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pug</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">render</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">content</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">cb</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> html</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>具体配置说明请查看<a href="https://github.com/vuejs/vueify#configuring-options" target="_blank" rel="noopener noreferrer">文档</a>.</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="添加依赖-pug">添加依赖 <code>pug</code><a href="#添加依赖-pug" class="hash-link" aria-label="添加依赖-pug的直接链接" title="添加依赖-pug的直接链接">​</a></h2><p>需要 <code>pug</code> 来解析, 所以添加</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">yarn</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> pug --dev</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="使用pug语法">使用pug语法<a href="#使用pug语法" class="hash-link" aria-label="使用pug语法的直接链接" title="使用pug语法的直接链接">​</a></h2><p>现在就可以在。vue文件中书写pug语法了。</p><div class="language-vue codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-vue codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;template lang="pug"&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  h1 parcel vue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/template&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// ...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>--
到此，大功告成！</p>]]></content>
        <category label="parcel" term="parcel"/>
        <category label="vue" term="vue"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Parcel 开启三大CSS预处理器--Stylus/Less/Sass]]></title>
        <id>https://p2yang.github.io/blog/parcel-step-2</id>
        <link href="https://p2yang.github.io/blog/parcel-step-2"/>
        <updated>2018-01-26T19:59:28.000Z</updated>
        <summary type="html"><![CDATA[Parcel 默认支持 Stylus/Less/Sass, 只不过需要安装对应的npm依赖。官方文档言语模糊，我们这里便来实践一下具体如何开启tylus/Less/Sass。]]></summary>
        <content type="html"><![CDATA[<p>Parcel 默认支持 Stylus/Less/Sass, 只不过需要安装对应的npm依赖。官方文档言语模糊，我们这里便来实践一下具体如何开启tylus/Less/Sass。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="支持-stylus">支持 <strong>stylus</strong><a href="#支持-stylus" class="hash-link" aria-label="支持-stylus的直接链接" title="支持-stylus的直接链接">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">yarn</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> stylus --dev</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如在 App.vue 同目录下新建<strong><em>style.styl</em></strong> 样式文件, 然后引入：</p><div class="language-vue codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-vue codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// template 和 script 内容略过</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;style lang="stylus"&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@import './style';</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/style&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>启动，会看到 Parcel 默认将样式文件内联到<code>&lt;head&gt;</code>标签中。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="支持-less">支持 <strong>less</strong><a href="#支持-less" class="hash-link" aria-label="支持-less的直接链接" title="支持-less的直接链接">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">yarn</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">less</span><span class="token plain"> --dev</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如在 App.vue 同目录下新建<strong><em>style.less</em></strong> 样式文件, 然后引入：</p><div class="language-vue codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-vue codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// template 和 script 内容略过</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;style lang="less"&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@import './style';</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/style&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="支持-sass">支持 <strong>sass</strong><a href="#支持-sass" class="hash-link" aria-label="支持-sass的直接链接" title="支持-sass的直接链接">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">yarn</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> node-sass --dev</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如在 App.vue 同目录下新建<strong><em>style.scss</em></strong> 样式文件, 然后引入：</p><div class="language-vue codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-vue codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// template 和 script 内容略过</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;style lang="scss"&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@import './style';</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/style&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>注意：上述如果启动失败，可以重装 <code>babel-preset-env</code> 依赖。</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="问题">问题<a href="#问题" class="hash-link" aria-label="问题的直接链接" title="问题的直接链接">​</a></h2><p>实践过程中发现一个问题： 在vue 组件 <code>&lt;style&gt;</code> 中，通过 <code>@import</code>引入样式文件后，修改样式文件 HMR 失效。 这是个让人很受伤的问题。该问题是<code>parcel-plugin-vue</code>(<a href="https://github.com/BoltDoggy/parcel-plugin-vue/issues/18" target="_blank" rel="noopener noreferrer">查看issue18</a>) 导致的，目前还未解决。</p><p>我们这里可以先在vue 组件的 <code>&lt;script&gt;</code>中将样式 import 进来， HMR有效。</p>]]></content>
        <category label="parcel" term="parcel"/>
        <category label="vue" term="vue"/>
        <category label="css" term="css"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Parcel + Vue 尝鲜]]></title>
        <id>https://p2yang.github.io/blog/parcel-vue</id>
        <link href="https://p2yang.github.io/blog/parcel-vue"/>
        <updated>2018-01-24T19:46:26.000Z</updated>
        <summary type="html"><![CDATA[Webpack 久负盛名，包罗万象。若是用其造轮子的话，难免修修补补。年前兴起了Parcel打包工具，号称“极速零配置”，让人不胜向往。这不得空了，就来尝尝鲜，记录下如何使用 Parcel + Vue进行开发。]]></summary>
        <content type="html"><![CDATA[<p>Webpack 久负盛名，包罗万象。若是用其造轮子的话，难免修修补补。年前兴起了Parcel打包工具，号称“极速零配置”，让人不胜向往。这不得空了，就来尝尝鲜，记录下如何使用 Parcel + Vue进行开发。</p><p>这里是<a href="https://github.com/p2yang/parcel-vue" target="_blank" rel="noopener noreferrer">示例代码</a>!</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="预备">预备<a href="#预备" class="hash-link" aria-label="预备的直接链接" title="预备的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="两个依赖">两个依赖<a href="#两个依赖" class="hash-link" aria-label="两个依赖的直接链接" title="两个依赖的直接链接">​</a></h3><ul><li><p><code>parcel-bundler</code>(<a href="https://www.npmjs.com/package/parcel-bundler" target="_blank" rel="noopener noreferrer">戳我👇</a>)
这是 <strong><em>Parcel</em></strong> 打包工具，“极速零配置”的起源。</p></li><li><p><code>parcel-plugin-vue</code>(<a href="https://www.npmjs.com/package/parcel-plugin-vue" target="_blank" rel="noopener noreferrer">戳我👇</a>)
这是一个 parcel 插件，使 pacel 支持 <code>.vue</code> 文件。</p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="项目结构">项目结构<a href="#项目结构" class="hash-link" aria-label="项目结构的直接链接" title="项目结构的直接链接">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">parcel-vue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── package.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── .babelrc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── index.html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├──src</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ├── App.vue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ├── main.js</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这是基本的项目结构。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="开始">开始<a href="#开始" class="hash-link" aria-label="开始的直接链接" title="开始的直接链接">​</a></h2><ol><li><p>安装parcel相关开发依赖</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">yarn add parcel-bundler parcel-plugin-vue babel-preset-env -D</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>安装vue</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">yarn add vue</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>添加入口文件 <code>index.html</code></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;!DOCTYPE html&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;html lang="en"&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;head&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;meta charset="UTF-8"&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;title&gt;parcel + vue&lt;/title&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/head&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;body&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;div id="app"&gt;&lt;/div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;script src="./src/main.js"&gt;&lt;/script&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/body&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/html&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>添加脚本内容 <code>main.js</code> 和 vue组件 <code>App.vue</code></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// ./src/main.js</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import Vue from 'vue'</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import App from './App'</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">new Vue({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  el: '#app',</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  render: h =&gt; h(App)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">})</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// App.vue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;template&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;h1&gt;parcel vue&lt;/h1&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/template&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;script&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export default {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: 'App'</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/script&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>配置 <code>.babelrc</code></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  "presets": [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "env"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><p>大功告成！！！</p><p>额，再加条启动脚本吧！</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// package.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  "scripts": {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "start": "parcel index.html"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Node执行:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">yarn</span><span class="token plain"> start</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>好了，浏览器打开http://localhost:1234看看吧。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="生产环境">生产环境<a href="#生产环境" class="hash-link" aria-label="生产环境的直接链接" title="生产环境的直接链接">​</a></h2><p>构建生产环境，只需要执行：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">parcel build index.html --public-url ./</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这里以index.html为入口，parcel会自动识别和提取相关依赖资源，并在根目录下创建 <code>dist</code> 文件夹。这里 <code>dist</code> 名称是默认的，可以按意愿更改。可以通过命令 <code>parcel build -h</code> 查看具体的参数列表。</p><p>查看<a href="https://github.com/p2yang/parcel-vue" target="_blank" rel="noopener noreferrer">示例代码</a>。</p>]]></content>
        <category label="parcel" term="parcel"/>
        <category label="vue" term="vue"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[frp 内网穿透实践]]></title>
        <id>https://p2yang.github.io/blog/net-cross-by-frp</id>
        <link href="https://p2yang.github.io/blog/net-cross-by-frp"/>
        <updated>2018-01-11T19:24:09.000Z</updated>
        <summary type="html"><![CDATA[假设你在本地开发一个网站，需要在浏览器上进行测试，一般直接用IP访问即可，麻烦一点的可以设置代理。但如果有这样一种浏览器，她只能访问公网上的站点，完全忽视以上两种方法的搭讪，这个时候我们就可以使用“内网穿透”了。实现方法有很多，这里记录一下我采用frp实现此功能的过程。]]></summary>
        <content type="html"><![CDATA[<p>假设你在本地开发一个网站，需要在浏览器上进行测试，一般直接用IP访问即可，麻烦一点的可以设置代理。但如果有这样一种浏览器，她只能访问公网上的站点，完全忽视以上两种方法的搭讪，这个时候我们就可以使用“内网穿透”了。实现方法有很多，这里记录一下我采用frp实现此功能的过程。</p><p><a href="https://github.com/fatedier/frp" target="_blank" rel="noopener noreferrer">frp</a>是github上的一个开源项目，配置起来很简单。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="准备">准备<a href="#准备" class="hash-link" aria-label="准备的直接链接" title="准备的直接链接">​</a></h2><p>我们需要一台服务器来运行frp server，然后本地运行frp client端。最好还有一个域名来快速访问（当然，没有也可以，无名胜有名嘛）。</p><ul><li>一台服务器</li><li>一个域名</li><li>frp server端</li><li>frp client端</li></ul><p>点击前往<a href="https://github.com/fatedier/frp/releases" target="_blank" rel="noopener noreferrer">frp下载</a>，选择对应的系统版本，下载包中包含了server端和client端。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="server配置和启动">server配置和启动<a href="#server配置和启动" class="hash-link" aria-label="server配置和启动的直接链接" title="server配置和启动的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="下载安装">下载安装<a href="#下载安装" class="hash-link" aria-label="下载安装的直接链接" title="下载安装的直接链接">​</a></h3><p>在服务器上，选择好目录，执行以下命令下载frp:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">wget</span><span class="token plain"> https://github.com/fatedier/frp/releases/download/v0.14.1/frp_0.14.1_linux_386.tar.gz</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后，解压</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">tar</span><span class="token plain"> zxvf frp_0.14.1_linux_386.tar.gz</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>解压出的文件夹中server和client的配置, 如下图示
<img loading="lazy" alt="frp_0.14.1_linux_386" src="/assets/images/server-747bb8c6692c760f2e9e474b808e44f2.png" width="1006" height="74" class="img_ev3q"></p><p>这里，我们只需要用到 <code>frps</code> 和 <code>frps.ini</code> 两个文件。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="修改配置">修改配置<a href="#修改配置" class="hash-link" aria-label="修改配置的直接链接" title="修改配置的直接链接">​</a></h3><p>我们在默认配置下添加 http 访问端口配置：</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vhost_http_port = 8080</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>frps.ini</code> 结果如下：</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[common]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bind_port = 7000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vhost_http_port = 8080</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>接下来就可以启动了。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="启动">启动<a href="#启动" class="hash-link" aria-label="启动的直接链接" title="启动的直接链接">​</a></h3><p>在当前目录下执行:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./frps -c ./frps.ini</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>可以看到：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">▶ ./frps -c ./frps.ini</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2018/01/11 19:57:37 [I] [service.go:88] frps tcp listen on 0.0.0.0:7000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2018/01/11 19:57:37 [I] [service.go:117] http service listen on 0.0.0.0:8080</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2018/01/11 19:57:37 [I] [main.go:112] Start frps success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2018/01/11 19:57:37 [I] [main.go:114] PrivilegeMode is enabled, you should pay more attention to security issues</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>到此，server端启动完成，接下来看看本地该如何（注意，请勿关闭server，如要后台运行请用其他辅助工具，或看升级介绍）。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="解析个域名先">解析个域名先<a href="#解析个域名先" class="hash-link" aria-label="解析个域名先的直接链接" title="解析个域名先的直接链接">​</a></h3><p>为了方便访问，我们先添加一条解析记录吧。
给自己的域名<a href="http://p2yang.com" target="_blank" rel="noopener noreferrer">p2yang.com</a>添加一条A记录，解析到上面的服务器IP(假设是xx.xx.xx.xx), 这里二级域名设为 work.</p><p>然后，来配置客户端吧。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="frp-client配置与连接">frp client配置与连接<a href="#frp-client配置与连接" class="hash-link" aria-label="frp client配置与连接的直接链接" title="frp client配置与连接的直接链接">​</a></h3><p>根据本机系统下载客户端。这里会用到两个文件: <code>frpc</code> 和 <code>frpc.ini</code>.
打开<code>frpc.ini</code>, 添加配置:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[common]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">server_addr = xx.xx.xx.xx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">server_port = 7000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[web]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type = http</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">local_port = 80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">custom_domains = www.yourdomain.com</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>说明：这里的 <code>server_addr</code> 是你启动 frp server的服务器; <code>type</code> 设为 http; <code>custom_domains</code> 设为解析的域名; 其他默认即可。<code>[web]</code> 中括号中的名字可以改。</p><p>执行：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">▶ ./frpc -c ./frpc.ini</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2018</span><span class="token plain">/01/11 </span><span class="token number" style="color:#36acaa">20</span><span class="token plain">:11:03 </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">I</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">control.go:277</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">7621df25976e76bb</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> login to server success, get run </span><span class="token function" style="color:#d73a49">id</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">7621df25976e76bb</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, server udp port </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2018</span><span class="token plain">/01/11 </span><span class="token number" style="color:#36acaa">20</span><span class="token plain">:11:03 </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">I</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">control.go:412</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">7621df25976e76bb</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">web</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> start proxy success</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>到此，启动成功！！！
开启本地静态服务，打开链接<a href="http://work.p2yang.com:8080" target="_blank" rel="noopener noreferrer">http://work.p2yang.com:8080</a>, 即可在公网上访问本地的开发资源。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="进阶">进阶<a href="#进阶" class="hash-link" aria-label="进阶的直接链接" title="进阶的直接链接">​</a></h3><p>如何让多个开发者共用一个frp server，并享用自定义的二级域名？</p><p>这里frp配置也很简单。</p><p><code>frps.ini</code> 添加配置如下：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[common]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bind_port = 7000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vhost_http_port = 8080</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">subdomain_host = p2yang.com</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>frpc.ini</code> 添加配置如下：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[common]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">server_addr = xx.xx.xx.xx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">server_port = 7000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[web]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type = http</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">local_port = 80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">subdomain = work</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>注意，不同用户的 <code>[web]</code> 配置需要取不同的名字，<code>subdomain</code> 自己定义即可。当然，重名会产生冲突，请保持独一无二。</p><p>域名添加 <code>*</code> 泛解析。</p><p>然后，不同的用户启动自己的frp客户端，即可共享frp server了。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="结语">结语<a href="#结语" class="hash-link" aria-label="结语的直接链接" title="结语的直接链接">​</a></h2><p>frp还支持其他许多功能，点击查看<a href="https://github.com/fatedier/frp/blob/master/README_zh.md" target="_blank" rel="noopener noreferrer">官方中文文档</a>。我就先到这里吧。</p>]]></content>
        <category label="http" term="http"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[关于 Opera Mini 开发的那些事儿]]></title>
        <id>https://p2yang.github.io/blog/opera-mini</id>
        <link href="https://p2yang.github.io/blog/opera-mini"/>
        <updated>2018-01-10T15:12:22.000Z</updated>
        <summary type="html"><![CDATA[前期暂时先记录这些，稍后再补充。]]></summary>
        <content type="html"><![CDATA[<p>前期暂时先记录这些，稍后再补充。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="不支持的一些-css-style">不支持的一些 CSS Style<a href="#不支持的一些-css-style" class="hash-link" aria-label="不支持的一些 CSS Style的直接链接" title="不支持的一些 CSS Style的直接链接">​</a></h2><ul><li>line-height</li><li>border-radius</li><li>CSS gradients (老老实实用 background-color 吧)</li><li>CSS animations</li><li>font-family</li><li>icon fonts (用svg替代)</li><li>只有body元素支持滚动, 其他元素即使加overflow也不行。即使是iframe，也会被切掉不足显示的部分。</li><li>fixed定位</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="注意事项">注意事项：<a href="#注意事项" class="hash-link" aria-label="注意事项：的直接链接" title="注意事项：的直接链接">​</a></h2><ul><li>动态图只会渲染第一帧，不会动。</li><li>图片会被压缩，建议不要用图片显示文本。如果非要用的话，可在CSS中引入图片，并且对图片做优化适配。</li><li>不支持任何动画，包括动态gif, 动态svg, blink/marquee元素等。因为服务器渲染并发送给客户端的只是一张快照。</li><li>flex 布局会影响元素的width, 导致ellipsis失败，注意使用；</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="参考">参考<a href="#参考" class="hash-link" aria-label="参考的直接链接" title="参考的直接链接">​</a></h2><p><a href="https://dev.opera.com/articles/opera-mini-content-authoring-guidelines/#basic-html-css" target="_blank" rel="noopener noreferrer">Opera Mini: Web Content Authoring Guidelines</a>
<a href="https://dev.opera.com/articles/making-sites-work-opera-mini/" target="_blank" rel="noopener noreferrer">Making websites that work well on Opera Mini</a></p>]]></content>
        <category label="browser" term="browser"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Node API - Querystring]]></title>
        <id>https://p2yang.github.io/blog/node-querystring</id>
        <link href="https://p2yang.github.io/blog/node-querystring"/>
        <updated>2018-01-04T22:56:50.000Z</updated>
        <summary type="html"><![CDATA[querystring 是一个实用的 URL query 字符串处理工具，可以序列化一串键值对字符串，也可以将对象转化成一段 a=b&c=d 形式的字符串。总之，非常好用，尤其是处理跟url query相关参数的时候。]]></summary>
        <content type="html"><![CDATA[<p><code>querystring</code> 是一个实用的 URL query 字符串处理工具，可以序列化一串键值对字符串，也可以将对象转化成一段 <code>a=b&amp;c=d</code> 形式的字符串。总之，非常好用，尤其是处理跟url query相关参数的时候。</p><p>说明：本文是基于 <a href="mailto:node@9.3.0" target="_blank" rel="noopener noreferrer">node@9.3.0</a> 整理。查看<a href="https://nodejs.org/docs/v9.3.0/api/querystring.html" target="_blank" rel="noopener noreferrer">官方文档</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="基本用法">基本用法<a href="#基本用法" class="hash-link" aria-label="基本用法的直接链接" title="基本用法的直接链接">​</a></h2><p>在 node 环境下，我们可以直接 require 或 import，如下：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> querystring </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'querystring'</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>需要说明的是，npm上有一个 <a href="https://www.npmjs.com/package/qs" target="_blank" rel="noopener noreferrer">qs</a> 包，跟querystring类似，但功能更强大，可以看看。</p><p>node querystring 公开的有四个方法，我们来看一看。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="parse-爱-stringify">parse 爱 stringify<a href="#parse-爱-stringify" class="hash-link" aria-label="parse 爱 stringify的直接链接" title="parse 爱 stringify的直接链接">​</a></h2><p><code>parse</code>和<code>stringify</code>总是形影不离，在<code>JSON</code>中如此，这里也是一样。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="querystringparsestr-sep-eq-options">querystring.parse(str[, sep[, eq<!-- -->[, options]<!-- -->]])<a href="#querystringparsestr-sep-eq-options" class="hash-link" aria-label="querystringparsestr-sep-eq-options的直接链接" title="querystringparsestr-sep-eq-options的直接链接">​</a></h3><p>可选参数有点多，先来介绍一下:</p><ul><li>str: <code>String</code>, 目标字符串;</li><li>sep: <code>String</code>, str 中键值对间的分隔符，默认是<code>&amp;</code>;</li><li>eq: <code>String</code>, str 中key和value间的分隔符，默认是<code>=</code>;</li><li>options: <code>Object</code>, 包含三个属性：<ul><li>decodeURIComponent: <code>Function</code>, 解码方法，默认使用<code>querystring.unescape()</code></li><li>maxKeys: <code>Number</code>, 可以解析的最大key数目，默认是1000。设为0，则表示不限制数量。</li></ul></li></ul><p>示例如下:</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">querystring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">parse</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'foo=bar&amp;abc=xyz&amp;abc=123'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/* Returns</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">  foo: 'bar',</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">  abc: ['xyz', '123']</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">*/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>注意：官方文档说，返回的对象不完全继承js的<code>Object</code>, 所以诸如<code>obj.toString</code>, <code>obj.hasOwnProperty</code>之类未定义的方法，无法使用哦～</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="querystringstringifyobj-sep-eq-options">querystring.stringify(obj[, sep[, eq<!-- -->[, options]<!-- -->]])<a href="#querystringstringifyobj-sep-eq-options" class="hash-link" aria-label="querystringstringifyobj-sep-eq-options的直接链接" title="querystringstringifyobj-sep-eq-options的直接链接">​</a></h3><p><code>sep</code>,<code>eq</code>同上，默认分别是<code>&amp;</code>，<code>=</code>.</p><ul><li>obj: <code>Object</code>, 目标对象</li><li>options: <code>Object</code>, 包含一个方法<ul><li>encodeURIComponent: <code>Function</code>, 编码方法，默认使用<code>querystring.escape()</code></li></ul></li></ul><p><code>obj</code>的属性有所限制，只能转化 <code>String</code>, <code>Number</code>, <code>Boolean</code>, <code>String[]</code>, <code>Number[]</code>, <code>Boolean[]</code>类型的的值，其他类型的值会被转化为空字符串。</p><p>示例如下:</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">querystring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">stringify</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">foo</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'bar'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">baz</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'qux'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'quux'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">corge</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">''</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// returns 'foo=bar&amp;baz=qux&amp;baz=quux&amp;corge='</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">querystring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">stringify</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">foo</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'bar'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">baz</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'qux'</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">';'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">':'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// returns 'foo:bar;baz:qux'</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="离开还是留下">离开，还是留下？<a href="#离开还是留下" class="hash-link" aria-label="离开，还是留下？的直接链接" title="离开，还是留下？的直接链接">​</a></h2><p><code>escape</code> or <code>unescape</code>，选择只取决于你。一般不怎么用。
官方有云，</p><blockquote><p>The querystring.escape() method is used by querystring.stringify() and <strong>is generally not expected to be used directly</strong>. It is exported primarily to allow application code to provide a replacement percent-encoding implementation if necessary by assigning querystring.escape to an alternative function.</p></blockquote><p>所以，用不用随你心意。我们这里就简单说下吧（反正写的都很简洁。。。）。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="querystringescapestr">querystring.escape(str)<a href="#querystringescapestr" class="hash-link" aria-label="querystring.escape(str)的直接链接" title="querystring.escape(str)的直接链接">​</a></h3><p>编码。</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">querystring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">escape</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'https://nodejs.org/dist/latest-v9.x/docs/api/querystring.html?nav=faq&amp;sa=sae'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Returns 'https%3A%2F%2Fnodejs.org%2Fdist%2Flatest-v9.x%2Fdocs%2Fapi%2Fquerystring.html%3Fnav%3Dfaq%26sa%3Dsae'</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="querystringunescapestr">querystring.unescape(str)<a href="#querystringunescapestr" class="hash-link" aria-label="querystring.unescape(str)的直接链接" title="querystring.unescape(str)的直接链接">​</a></h3><p>解码，与escape相反。</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">querystring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">unescape</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'https%3A%2F%2Fnodejs.org%2Fdist%2Flatest-v9.x%2Fdocs%2Fapi%2Fquerystring.html%3Fnav%3Dfaq%26sa%3Dsae'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Returns 'https://nodejs.org/dist/latest-v9.x/docs/api/querystring.html?nav=faq&amp;sa=sae'</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="结语">结语<a href="#结语" class="hash-link" aria-label="结语的直接链接" title="结语的直接链接">​</a></h2><p>说实话，之前从别人的文章中去看用法，总觉得捉急。md不写时间，不写版本，行文也不格式化，极易产生误解。后来总算明白了，别人嚼烂剩下，心里要有个谱儿。主动被动之间，不只有情趣！</p>]]></content>
        <category label="node" term="node"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[关于网页打印的开发实践]]></title>
        <id>https://p2yang.github.io/blog/html-print</id>
        <link href="https://p2yang.github.io/blog/html-print"/>
        <updated>2017-12-11T12:31:50.000Z</updated>
        <summary type="html"><![CDATA[最近接到了一个PC打印需求，实现网页特定内容打印功能。据我所知，打印是直接调用 window.print() 就能唤起浏览器打印功能的。MDN上的描述及其简洁：调用打印，不能传参，不属于任何标准。也就是说，网页是啥样，打印估计就是傻样。一番调研，找到了几种解决办法列举如下。]]></summary>
        <content type="html"><![CDATA[<p>最近接到了一个PC打印需求，实现网页特定内容打印功能。据我所知，打印是直接调用 <code>window.print()</code> 就能唤起浏览器打印功能的。<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/print" target="_blank" rel="noopener noreferrer">MDN</a>上的描述及其简洁：调用打印，不能传参，不属于任何标准。也就是说，网页是啥样，打印估计就是傻样。一番调研，找到了几种解决办法列举如下。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="css-media-print">CSS Media print<a href="#css-media-print" class="hash-link" aria-label="CSS Media print的直接链接" title="CSS Media print的直接链接">​</a></h2><p>对于定制性不高，结构较为简单的页面来说，使用CSS的Media type属性较为合适。</p><p>腾讯CDC有一篇 《<a href="http://cdc.tencent.com/2014/08/19/print-%E8%A2%AB%E5%9F%8B%E6%B2%A1%E7%9A%84media-type/" target="_blank" rel="noopener noreferrer">Print —— 被埋没的Media Type</a>》对 <code>@media print</code> 的用法讲述的十分清晰，可前往查阅，本文不再赘述。</p><p>简单来说，我们可以在 <code>@media print</code> 中书写打印所需的样式，无关内容可以直接 <code>display: none</code> 掉。示例如下：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;!-- css --&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@media print {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;!-- code your style --&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我们还可以外链一个单独的样式文件来存储打印样式，如下：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;link rel="stylesheet" href="print.css" media="print"/&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>补充说明：样式归样式，打印还得靠 <code>widnow.print()</code>。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="iframe">Iframe<a href="#iframe" class="hash-link" aria-label="Iframe的直接链接" title="Iframe的直接链接">​</a></h2><p>如果定制化较高，基于当前页面改动太大的话，使用<code>@media print</code> 就不太合适了。这时我们可以使用嵌套 <em>iframe</em> 的方法来实现另类的打印。</p><p>我们可以动态创建 iframe 元素，将想要打印的内容及样式注入其中，再将iframe元素隐藏到当前页面，然后等iframe里的内容加载完后，直接调用 <code>iframe.contentWindow.document.print()</code> 即可。</p><p>说起来简单，实际操作还是挺复杂的，好在github上已经有做好的轮子了 —— <a href="https://github.com/crabbly/print.js" target="_blank" rel="noopener noreferrer">Print.js</a>。
不过，个人觉得它支持的格式虽多，但有一些局限性，所以我fork做了一些简单的修改，即<a href="https://github.com/p2yang/html-print" target="_blank" rel="noopener noreferrer">html-print</a>，目前主要用于打印html内容。</p><p>话说<code>Print.js</code> 的源码清晰明了，如果直接用不方便的话，可以fork定制自己的内容。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="结语">结语<a href="#结语" class="hash-link" aria-label="结语的直接链接" title="结语的直接链接">​</a></h2><p>以上是纯粹的网页开发者可以做的那些事儿，更强大省事儿的解决方法是用插件，前提是你的内容值得用户默默的装！</p>]]></content>
        <category label="html" term="html"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[npm包发布实践]]></title>
        <id>https://p2yang.github.io/blog/npm-package</id>
        <link href="https://p2yang.github.io/blog/npm-package"/>
        <updated>2017-12-07T12:41:16.000Z</updated>
        <summary type="html"><![CDATA[npm package下载容易，publish也很容易。我们来实践一下吧！]]></summary>
        <content type="html"><![CDATA[<p>npm package下载容易，publish也很容易。我们来实践一下吧！</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="基本流程">基本流程<a href="#基本流程" class="hash-link" aria-label="基本流程的直接链接" title="基本流程的直接链接">​</a></h2><ol><li>准备项目;</li><li>npm注册;</li><li>本地npm登录;</li><li>发布.</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="准备项目">准备项目<a href="#准备项目" class="hash-link" aria-label="准备项目的直接链接" title="准备项目的直接链接">​</a></h2><p>准备好你想要发布到npm的项目
新项目请执行 <code>npm init</code>。示例如图：
<img loading="lazy" src="/assets/images/npm-index-1da5d832412270e9d95da7983db33975.png" width="362" height="438" class="img_ev3q"></p><p>准备好项目之后，就可以进行登录发布了。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="npm注册">npm注册<a href="#npm注册" class="hash-link" aria-label="npm注册的直接链接" title="npm注册的直接链接">​</a></h2><p>在npm官网上注册一个账号，我们将以此帐号的名义来发布npm包。<a href="https://www.npmjs.com/signup" target="_blank" rel="noopener noreferrer">前往注册</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="本地npm登录">本地npm登录<a href="#本地npm登录" class="hash-link" aria-label="本地npm登录的直接链接" title="本地npm登录的直接链接">​</a></h2><p>在本地终端执行:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">npm addUser</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>执行该命令后，依次输入用户名、密码、邮箱等信息。如图所示：
<img loading="lazy" src="/assets/images/npm-login-cadc2da57f15d042ebe4b10c6314e10f.png" width="770" height="306" class="img_ev3q"></p><p>以上，登录完成。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="发布">发布<a href="#发布" class="hash-link" aria-label="发布的直接链接" title="发布的直接链接">​</a></h2><p>执行发布，命令如下：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">npm publish</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>发布的npm package 会自动使用 <code>package.json</code> 中的 <strong><em>version</em></strong>作为版本号。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="遇到的问题">遇到的问题<a href="#遇到的问题" class="hash-link" aria-label="遇到的问题的直接链接" title="遇到的问题的直接链接">​</a></h2><ol><li>package name如果已存在，发布时会出现权限错误，导致发布失败，改名即可。错误信息如下：</li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">▶ npm publish</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm ERR! publish Failed PUT 403</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm ERR! code E403</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm ERR! You do not have permission to publish "npm-package-test". Are you logged in as the correct user? : npm-package-test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm ERR! A complete log of this run can be found in:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm ERR!     /Users/pyang/.npm/_logs/2017-12-07T05_28_57_277Z-debug.log</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="结语">结语<a href="#结语" class="hash-link" aria-label="结语的直接链接" title="结语的直接链接">​</a></h2><p><code>npm publish</code>有个 <strong><em>prepublish</em></strong> 钩子，可以自动执行相关脚本。在<code>package.json</code>的 <strong><em>scripts</em></strong> 中添加一条 <strong><em>prepublish</em></strong> 的脚本即可。</p><p>整理一下套路，操作就清楚多了。还是多尝试吧！</p>]]></content>
        <category label="npm" term="npm"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[小试 Momentjs Query API]]></title>
        <id>https://p2yang.github.io/blog/momentjs-query</id>
        <link href="https://p2yang.github.io/blog/momentjs-query"/>
        <updated>2017-11-28T00:33:55.000Z</updated>
        <summary type="html"><![CDATA[moment用的好，可省一大笔精力和时间。]]></summary>
        <content type="html"><![CDATA[<p>moment用的好，可省一大笔精力和时间。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="起始与结束">起始与结束<a href="#起始与结束" class="hash-link" aria-label="起始与结束的直接链接" title="起始与结束的直接链接">​</a></h2><ol><li>周期的开始时间</li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">moment().startOf(String)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>周期的结束时间</li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">moment().endOf(String)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>String 支持以下参数：<ul><li>year</li><li>month</li><li>quarter</li><li>week</li><li>isoWeek</li><li>day</li><li>date</li><li>hour</li><li>minute</li><li>second</li></ul></li></ul><p>示例如下：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">moment().startOf('month');</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">moment().startOf('year');</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">moment().startOf('week');</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="boolean-判断">Boolean 判断<a href="#boolean-判断" class="hash-link" aria-label="Boolean 判断的直接链接" title="Boolean 判断的直接链接">​</a></h2><p>判断时间A是否在目标时间B之前或之后, 如：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  A／B 类型支持 Moment|String|Number|Date|Array</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  参数 String 可以是 year／month／week／day／hour／minute／second,可省略</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">moment(A).isBefore(B, String)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>  示例：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">const a = moment()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">a.isBefore('2017-11-27'); // true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">a.isAfter('2017-11-27'); // false</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>类似还有：</p><ol><li><p><code>isSame</code></p></li><li><p><code>isSameBefore</code></p></li><li><p><code>isSameAfter</code></p></li><li><p><code>isBetween</code></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">moment('2010-10-20').isBetween('2010-01-01', '2012-01-01', 'year'); // false</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p><code>isDST</code>
checks if the current moment is in daylight saving time.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">moment([2011, 2, 12]).isDST(); // false, March 12 2011 is not DST</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p><code>isDSTShifted</code></p></li><li><p><code>isMoment</code></p></li><li><p><code>isLeapYear</code></p></li><li><p><code>isDate</code></p></li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="其他">其他<a href="#其他" class="hash-link" aria-label="其他的直接链接" title="其他的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="时间戳">时间戳<a href="#时间戳" class="hash-link" aria-label="时间戳的直接链接" title="时间戳的直接链接">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">moment().valueOf(); // 毫秒数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">moment().unix(); // 秒数</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="后记">后记<a href="#后记" class="hash-link" aria-label="后记的直接链接" title="后记的直接链接">​</a></h2><p>官方文档示例和描述清晰明了，可点击<a href="http://momentjs.com/docs/#/parsing/" target="_blank" rel="noopener noreferrer">查看官方文档</a>，不多赘述。</p>]]></content>
        <category label="moment" term="moment"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[webpack 配置 react 开发环境]]></title>
        <id>https://p2yang.github.io/blog/webpack</id>
        <link href="https://p2yang.github.io/blog/webpack"/>
        <updated>2017-11-23T22:58:22.000Z</updated>
        <summary type="html"><![CDATA[webpack 配置错综复杂，每次独立配置也会让我的心情跟着复杂起来。而今再也受不了，拿来即用可以，拿来受罪可不行。便在这里记录一下用 webpack 配置 react 开发的问题和实现过程。]]></summary>
        <content type="html"><![CDATA[<p>webpack 配置错综复杂，每次独立配置也会让我的心情跟着复杂起来。而今再也受不了，拿来即用可以，拿来受罪可不行。便在这里记录一下用 webpack 配置 react 开发的问题和实现过程。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="预热">预热<a href="#预热" class="hash-link" aria-label="预热的直接链接" title="预热的直接链接">​</a></h3><p>react app 有现成的 build 工具, 可以快速生成项目配置，官方推荐 <a href="https://github.com/facebookincubator/create-react-app" target="_blank" rel="noopener noreferrer">create-react-app</a>。如果你不想在配置上死磕，可以去研究研究如何使用这个工具，更专注地书写业务代码。</p><p>本文参考 <a href="https://facebook.github.io/react/docs/hello-world.html" target="_blank" rel="noopener noreferrer">react官方文档</a> 和 <a href="https://webpack.js.org/guides/" target="_blank" rel="noopener noreferrer">webpack官方文档</a>，结合各路 bug 解决方案而写，有所疏漏还请自行体会和交流。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="初始化">初始化<a href="#初始化" class="hash-link" aria-label="初始化的直接链接" title="初始化的直接链接">​</a></h3><p>   ～～～</p><ol><li><p>初始化 <strong>package.json</strong></p><p>这里使用 <strong>yarn</strong> 代替 <strong>npm</strong> 来配置和安装各路插件包，使用方法基本类似（<a href="https://yarnpkg.com/zh-Hans/docs" target="_blank" rel="noopener noreferrer">查看官方中文文档</a>）。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">yarn</span><span class="token plain"> init</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>一路默认即可，也可以自己填入你想要的信息，后悔了也能修改。</p></li><li><p>安装 <strong>webpack</strong></p><p>安装开发依赖: webpack</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">yarn</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> webpack --dev</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>配置 webpack 启动文件 <em>webpack.config.js</em></p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> webpack </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'webpack'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">entry</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'./src/index.js'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">output</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">filename</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'bundle.js'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">path</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'./dist'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">module</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> config</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>安装 <em>babel-loader</em></p><p>webpack 会将源文件打包输出到指定文件，所以我们需要配置入口和出口文件。另外，针对特定类型的文件，webpack 需要靠对应的 <em>loader</em> 来处理它们。由于本篇讲的是 <code>react</code>，所以这里需要加入 <a href="https://github.com/babel/babel-loader" target="_blank" rel="noopener noreferrer">babel-loader</a></p><p>安装该 loader 还需安装依赖 <em>babel-core</em> 、 <em>babel-preset-env</em> 。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">yarn</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> babel-loader babel-core babel-preset-env --dev</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后，在 <em>webpack.config.js</em> 中 config 添加配置：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token literal-property property" style="color:#36acaa">module</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">rules</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">test</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token regex regex-delimiter" style="color:#36acaa">/</span><span class="token regex regex-source language-regex" style="color:#36acaa">\.js$</span><span class="token regex regex-delimiter" style="color:#36acaa">/</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">exclude</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token regex regex-delimiter" style="color:#36acaa">/</span><span class="token regex regex-source language-regex" style="color:#36acaa">(node_modules|bower_components)</span><span class="token regex regex-delimiter" style="color:#36acaa">/</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">use</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">loader</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'babel-loader'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>要顺利启用 babel 需要添加一个配置文件，告诉她该如何执行。我们在根目录下添加 <em>.babelrc</em> 文件</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// .babelrc</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">"presets"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">"env"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">"react"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">"es2015"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>安装 <em>react</em></p><p>安装 react 和 react-dom</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">yarn</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> react react-dom</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>写入 react 内容</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">React</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'react'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">ReactDOM</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'react-dom'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token maybe-class-name">ReactDOM</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">render</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">h1</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token maybe-class-name">Hello</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> world</span><span class="token operator" style="color:#393A34">!</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">h1</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getElementById</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'root'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>配置 html 模板</p><p>webpack 会导出一个 js 文件，若想在前端页面中执行，需要一个 html 文件来引入。
我们在根目录下新建文件夹 <em>public</em> ，用于存放公共的静态资源。然后在其中新建文件 <em>index.html</em> ，添加 root 元素：</p><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">id</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">'</span><span class="token tag attr-value" style="color:#e3116c">root</span><span class="token tag attr-value punctuation" style="color:#393A34">'</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这里不用手写script标签来引入js，而用 webpack 插件来配置和引入。首先安装 <code>html-webpack-plugin</code>，</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">yarn</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> html-webpack-plugin --dev</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后，在 <em>webpack.config.js</em> 中添加 config 配置：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token maybe-class-name">HtmlWebpackPlugin</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'html-webpack-plugin'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token literal-property property" style="color:#36acaa">plugins</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">template</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'./public/index.html'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>上面，我们在 <em>template</em> 中指定 index.html 路径。</p></li><li><p>添加启动脚本</p><p>在 <em>package.json</em> 中添加 <code>scripts</code></p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token string-property property" style="color:#36acaa">"scripts"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">"build"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"webpack"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后，执行命令：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">yarn</span><span class="token plain"> run build</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>执行成功后，根目录下会生成 dist 文件夹，这就是我们所需要的文件了。</p></li></ol>]]></content>
        <category label="webpack" term="webpack"/>
    </entry>
</feed>